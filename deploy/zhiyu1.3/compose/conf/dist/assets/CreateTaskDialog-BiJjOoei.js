import{u as q,c as Y,g as L}from"./tasks-mvyL4cZG.js";import{_ as M,e as R,B as v,r as y,J as O,w as z,G,ae as H,f as d,k as w,o as I,i as l,h as s,j as f,c as J,H as A,I as K,p as V,t as P,y as Q,z as W}from"./index-CR6ovanu.js";const X=c=>(Q("data-v-433585c0"),c=c(),W(),c),Z={class:"form-row"},ee=X(()=>f("div",{class:"description-header"},[f("span",{class:"description-label"},"任务描述")],-1)),te={class:"dialog-footer"},ae={__name:"CreateTaskDialog",props:{visible:{type:Boolean,default:!1},projectId:{type:[String,Number],required:!0},taskId:{type:[String,Number],default:null}},emits:["update:visible","success","close"],setup(c,{emit:N}){const{proxy:p}=R(),i=c,k=N,_=v({get:()=>i.visible,set:r=>{k("update:visible",r)}}),n=v(()=>i.taskId),j=v(()=>n.value?"编辑任务":"新增任务"),b=y([]),u=y(null),g=y(!1),t=O({taskId:null,taskName:"",projectId:i.projectId,taskType:1,description:"",deadline:""}),x={taskName:[{required:!0,message:"名称不能为空",trigger:"blur"},{min:1,max:50,message:"名称长度要在1~50之间",trigger:"blur"}],projectId:[{required:!0,message:"所属项目不能为空",trigger:"blur"}],taskType:[{required:!0,message:"任务类型不能为空",trigger:"change"}]},h=()=>{t.taskId=null,t.taskName="",t.projectId=i.projectId,t.description="",t.deadline="",t.taskStatus=null};z(()=>i.taskId,async r=>{if(r)try{const e=await L(r);if(e.code===200){const o=e.data.task;t.taskId=o.taskId||null,t.taskName=o.taskName||"",t.taskType=o.taskType||"",t.projectId=o.projectId||i.projectId,t.description=o.description||"",t.deadline=o.deadline?new Date(o.deadline).toISOString().split("T")[0]:""}else p.$modal.msgError(e.msg||"获取任务详情失败")}catch(e){console.error("获取任务详情失败:",e),p.$modal.msgError("获取任务详情失败")}else h()},{immediate:!0});const C=()=>{u.value&&u.value.validate(async r=>{if(r)try{g.value=!0;let e;n.value?e=await q(t):e=await Y(t),e.code===200?k("success",{...e,isEdit:n.value}):p.$modal.msgError(e.msg||(n.value?"更新失败":"创建失败"))}catch(e){console.error(`${n.value?"更新":"创建"}任务失败:`,e),p.$modal.msgError(`${n.value?"更新":"创建"}任务失败`)}finally{g.value=!1}})},D=()=>{_.value=!1},S=()=>{u.value&&u.value.resetFields(),h(),k("close")};return G(()=>{H("task_type").then(r=>{b.value=r.data})}),(r,e)=>{const o=d("el-input"),m=d("el-form-item"),E=d("el-option"),F=d("el-select"),B=d("el-date-picker"),$=d("el-form"),T=d("el-button"),U=d("el-dialog");return I(),w(U,{title:j.value,modelValue:_.value,"onUpdate:modelValue":e[4]||(e[4]=a=>_.value=a),width:"800px","close-on-click-modal":!1,onClose:S},{footer:l(()=>[f("span",te,[s(T,{onClick:D},{default:l(()=>[V("取 消")]),_:1}),s(T,{type:"primary",onClick:C,loading:g.value},{default:l(()=>[V(P(n.value?"保 存":"确 定"),1)]),_:1},8,["loading"])])]),default:l(()=>[s($,{ref_key:"taskFormRef",ref:u,model:t,rules:x,"label-width":"0px"},{default:l(()=>[s(m,{prop:"name",class:"form-item-spacing"},{default:l(()=>[s(o,{modelValue:t.taskName,"onUpdate:modelValue":e[0]||(e[0]=a=>t.taskName=a),placeholder:"请输入任务名称",clearable:""},null,8,["modelValue"])]),_:1}),f("div",Z,[s(m,{prop:"taskType",class:"form-item-half"},{default:l(()=>[s(F,{modelValue:t.taskType,"onUpdate:modelValue":e[1]||(e[1]=a=>t.taskType=a),placeholder:"请选择任务类型",style:{width:"100%"}},{default:l(()=>[(I(!0),J(A,null,K(b.value,a=>(I(),w(E,{key:a.dictValue,label:a.dictLabel,value:parseInt(a.dictValue)},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),s(m,{prop:"deadline",class:"form-item-half"},{default:l(()=>[s(B,{modelValue:t.deadline,"onUpdate:modelValue":e[2]||(e[2]=a=>t.deadline=a),type:"date",placeholder:"请选择预计完成时间","value-format":"YYYY-MM-DD",style:{width:"100%"}},{prepend:l(()=>[V("预计时间")]),_:1},8,["modelValue"])]),_:1})]),s(m,{prop:"description",class:"form-item-spacing"},{default:l(()=>[ee,s(o,{modelValue:t.description,"onUpdate:modelValue":e[3]||(e[3]=a=>t.description=a),type:"textarea",placeholder:"请输入任务说明",rows:4},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["title","modelValue"])}}},oe=M(ae,[["__scopeId","data-v-433585c0"]]);export{oe as default};
