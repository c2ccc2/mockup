import{_ as ge,F as ke,e as ye,w as ve,r as I,J as z,L as Pe,G as be,f as w,M as Ne,c as V,j as a,h as s,N as M,k as v,i as l,p as c,H as ae,I as le,m as d,q as Z,K,y as Fe,z as je,O as Ce,o as f,l as q,P as Ie,t as P}from"./index-CR6ovanu.js";import{l as $e,a as we,b as Ve,e as Ue,c as Re,u as xe,d as De,f as Ee}from"./mockup-_KlAqIPi.js";const y=B=>(Fe("data-v-b6bacf88"),B=B(),je(),B),Se={class:"main"},ze={class:"header"},Me=y(()=>a("span",{class:"title"},"原型管理",-1)),Ze={class:"content"},qe={class:"card-header"},Be={class:"button-group"},Le={key:0,class:"no-versions"},Oe=["onClick"],He={key:0,class:"latest-tag"},Te={class:"version-actions"},Ae={class:"release-info"},Je={class:"info-row"},Ge={key:0},Ke=y(()=>a("h4",{class:"release-title"},"发布说明",-1)),Qe={class:"release-description"},We=y(()=>a("h4",{class:"release-title"},"相关文件",-1)),Xe={class:"related-files"},Ye={class:"file-item"},et=y(()=>a("span",null,"在线原型：",-1)),tt={class:"file-info"},at=["onClick"],lt=y(()=>a("span",{class:"hint-text"},"点击在线浏览",-1)),ot={class:"file-item"},st=y(()=>a("span",null,"原型RP文件：",-1)),it={class:"file-info"},dt={class:"file-item"},rt=y(()=>a("span",null,"需求文档：",-1)),ct={class:"file-info"},nt={class:"file-item"},pt=y(()=>a("span",null,"效果图文件：",-1)),ut={class:"file-info"},mt={class:"operate-area",align:"center"},ft={class:"dialog-footer"},ht={class:"dialog-footer"},_t={class:"upload-dialog"},gt=y(()=>a("div",{class:"upload-tip"},[a("span",{style:{color:"#67c23a"}},"支持扩展名：.zip "),a("br"),a("span",{style:{color:"#909399"}},"（单个文件建议不超过10MB）")],-1)),kt=y(()=>a("div",{class:"upload-tip"},[a("span",{style:{color:"#67c23a"}},"支持扩展名：.zip ,.rp "),a("br"),a("span",{style:{color:"#909399"}},"（单个文件建议不超过10MB）")],-1)),yt=y(()=>a("div",{class:"upload-tip"},[a("span",{style:{color:"#67c23a"}},"支持扩展名：.doc, .docx, .pdf "),a("br"),a("span",{style:{color:"#909399"}},"（单个文件建议不超过10MB）")],-1)),vt=y(()=>a("div",{class:"upload-tip"},[a("span",{style:{color:"#67c23a"}},"支持扩展名：.zip "),a("br"),a("span",{style:{color:"#909399"}},"（单个文件建议不超过10MB）")],-1)),Pt={class:"dialog-footer",align:"center"},bt={class:"dialog-footer"},Nt=ke({name:"prototype"}),Ft=Object.assign(Nt,{props:{projectId:{type:[String,Number],required:!0},projectName:{type:String,default:"项目"}},setup(B){const{proxy:h}=ye(),g=B;ve(()=>g.projectId,e=>{if(!(e==="0"||e===0)){if(e===""){console.log("knowLedge界面，项目ID是0 ，开始返回:");return}j(e)}});const T=I({pageIndex:1,pageSize:10}),Q=z({mockupName:[{required:!0,message:"原型名称不能为空",trigger:"blur"},{min:1,max:50,message:"原型名称长度不能超过50个字符",trigger:"blur"}]}),L=I([]),U=I(!1),R=I(!1),x=I(null),W=I(null),b=z({title:""}),oe=z({name:[{required:!0,message:"标题不能为空",trigger:"blur"},{max:50,message:"长度不能超过50个字符",trigger:"blur"}],rpZipPath:[{validator:(e,t,o)=>{!t&&m.rpZipPath||t?o():o(new Error("HTML文件为必填项"))},trigger:"change"}]}),n=z({open:!1,title:"发布原型",isUploading:!1,data:{name:"",desc:"",mockupId:""},headers:{Authorization:"Bearer "+Pe()},htmlUrl:"/prod-api".replace(/\/?$/,"")+"/common/upload",fileUrl:"/prod-api".replace(/\/?$/,"")+"/common/upload"}),$=I(!1),k=z({projectFileId:"",uploadDescription:"",mockupName:""}),se={title:[{required:!0,message:"标题不能为空",trigger:"blur"},{max:50,message:"长度不能超过50个字符",trigger:"blur"}],uploadDescription:[{required:!0,message:"文件描述不能为空",trigger:"blur"}]};async function j(e){if(!e)return;let o={projectId:String(e),pageNumber:T.value.pageIndex,pageSize:T.value.pageSize};try{const N=await $e(o);T.totalCount=N.total,L.value=N.rows,L.value.length>0&&await Promise.all(L.value.map(async _=>{try{const p=await we(_.mockupId);_.versions=p.data.map((u,D)=>({version:`v${u.releaseId}`,title:u.releaseName,description:u.releaseDesc,time:u.updateTime||u.createTime,createBy:u.createBy,projectFileId:u.releaseId,htmlFilePath:u.rpHtmlPath,zipFilePath:u.rpZipPath,prototypeFilePath:u.rpPath,requirementsFilePath:u.docPath,effectPictureFilePath:u.picPath,rpZipName:u.rpZipName||"",rpName:u.rpName||"",docName:u.docName||"",picName:u.picName||"",isExpanded:!1}))}catch(p){console.error(`获取文件列表失败(ID:${_.mockupId}):`,p),_.versions=[]}}))}catch(N){console.error("加载数据失败:",N),h.$modal.msgError("数据加载失败")}}function X(e){e.isExpanded=!e.isExpanded}function ie(){console.log("添加原型"),b.mockupName="",U.value=!0}async function Y(){try{await x.value.validate();const e=await Ve({projectId:g.projectId,...b});e.code===200?(h.$modal.msgSuccess("新增成功"),U.value=!1,j(g.projectId)):h.$modal.msgError("添加失败："+e.message)}catch(e){console.error("表单验证失败:",e)}}function de(e){const t=L.value.find(o=>o.mockupId===e);if(!t){h.$modal.msgError("未找到原型数据");return}Object.assign(b,{mockupId:t.mockupId,mockupName:t.mockupName}),R.value=!0}async function ee(){try{await x.value.validate();const e=await Ue({projectId:g.projectId,...b});e.code===200?(h.$modal.msgSuccess("修改成功"),R.value=!1,j(g.projectId)):h.$modal.msgError("修改失败："+e.message)}catch(e){console.error("表单验证失败:",e)}}async function re(e){try{await h.$modal.confirm("确定删除该原型？","警告",{type:"warning"})&&(await Ee(e.toString())).code===200&&(h.$modal.msgSuccess("删除成功"),j(g.projectId))}catch{console.log("取消删除")}}function ce(e){console.log("添加新版本，项目文件ID:",e),n.data.mockupId=e,n.open=!0}const m=z({rpZipPath:"",rpPath:"",docPath:"",picPath:"",rpZipName:"",rpName:"",docName:"",picName:""});function O(e,t,o){if(e.code===200){switch(console.log("上传成功:",e),o){case"html":m.rpZipPath=e.fileName,m.rpZipName=e.originalFilename;break;case"rp":m.rpPath=e.fileName,m.rpName=e.originalFilename;break;case"requirement":m.docPath=e.fileName,m.docName=e.originalFilename;break;case"image":m.picPath=e.fileName,m.picName=e.originalFilename;break}h.$modal.msgSuccess("上传成功")}else h.$modal.msgError("上传失败："+e.message);console.log("上传后，uploadData的值是:",Ce(m))}const A=I(!1);async function ne(){if(A.value){console.log("正在提交中，请勿重复点击");return}try{A.value=!0,await x.value.validate();const e={releaseName:n.data.name,releaseDesc:n.data.desc,mockupId:n.data.mockupId,projectId:g.projectId,rpZipPath:m.rpZipPath,rpPath:m.rpPath,docPath:m.docPath,picPath:m.picPath,rpZipName:m.rpZipName,rpName:m.rpName,docName:m.docName,picName:m.picName};console.log("最终提交的数据:",e);const t=await Re(e);t.code===200?(h.$modal.msgSuccess("提交成功"),J(),j(g.projectId)):h.$modal.msgError("提交失败："+t.message)}catch(e){console.error("表单验证失败:",e)}finally{A.value=!1}}function J(){console.log("关闭对话框的回调"),Object.assign(n.data,{name:"",desc:"",mockupId:"",projectId:""}),Object.assign(m,{rpZipPath:"",rpPath:"",docPath:"",picPath:"",rpZipName:"",rpName:"",docName:"",picName:""}),n.open=!1}function pe(e){const o="/prod-api".replace(/\/?$/,"")+"/profile"+e.htmlFilePath+"/start.html#&g=1";console.log("访问链接:",o),window.open(o,"_blank")}function ue(e,t){k.projectFileId=t.projectFileId,k.uploadDescription=t.description,k.title=t.title,$.value=!0}async function me(){try{await W.value.validate();const e=await xe({releaseId:k.projectFileId,releaseDesc:k.uploadDescription,releaseName:k.title});e.code===200?(h.$modal.msgSuccess("修改成功"),Object.assign(k,{projectFileId:"",uploadDescription:"",title:""}),$.value=!1,j(g.projectId)):h.$modal.msgError("修改失败："+e.message)}catch(e){console.error("表单验证失败:",e)}}function fe(){Object.assign(n.data,{name:"",desc:"",mockupId:"",projectId:""}),Object.assign(m,{rpZipPath:"",rpPath:"",docPath:"",picPath:"",rpZipName:"",rpName:"",docName:"",picName:""}),htmlUploadRef.value&&htmlUploadRef.value.clearFiles(),rpUploadRef.value&&rpUploadRef.value.clearFiles(),requirementUploadRef.value&&requirementUploadRef.value.clearFiles(),imageUploadRef.value&&imageUploadRef.value.clearFiles(),$.value=!1}function he(e,t){console.log("删除详细信息:",JSON.stringify(t,null,2)),h.$modal.confirm("是否确认删除该版本？").then(function(){return De(t.projectFileId)}).then(()=>{j(g.projectId),h.$modal.msgSuccess("删除成功")}).catch(()=>{})}function H(e){let t="",o="文件";if(typeof e=="object"?e.htmlFilePath?(t=e.zipFilePath,o="原型HTML文件"):e.prototypeFilePath?(t=e.prototypeFilePath,o="原型RP文件"):e.requirementsFilePath?(t=e.requirementsFilePath,o="需求文档"):e.effectPictureFilePath&&(t=e.effectPictureFilePath,o="效果图文件"):t=e,!t){h.$modal.msgError("文件路径不存在");return}const _=`${"/prod-api".replace(/\/?$/,"")}/profile${t}`,p=document.createElement("a");p.style.display="none",p.href=_;const E=`${(g.projectName||"项目").replace(/[\\/:*?"<>|]/g,"_")}_${o}`;p.setAttribute("download",E),document.body.appendChild(p),p.click(),document.body.removeChild(p)}function te(e,t){if(t.length===0)return!1;const N=t.map(_=>_.version).sort((_,p)=>p-_)[0];return e.version===N}function _e(e){e.forEach(t=>{t.isExpanded=!t.isExpanded})}return be(()=>{j(g.projectId)}),(e,t)=>{const o=w("el-button"),N=w("el-card"),_=w("el-input"),p=w("el-form-item"),u=w("el-form"),D=w("el-dialog"),E=w("el-upload"),S=Ne("hasPermi");return f(),V("div",Se,[a("div",ze,[Me,M((f(),v(o,{class:"right-button",onClick:ie},{default:l(()=>[c("添加原型")]),_:1})),[[S,["project:mockup:add"]]])]),a("div",Ze,[(f(!0),V(ae,null,le(d(L),(i,F)=>(f(),v(N,{key:F,class:"prototype-card hidden-sm-and-down"},{header:l(()=>[a("div",qe,[a("span",null,P(i.mockupName),1),a("div",Be,[M((f(),v(o,{onClick:r=>ce(i.mockupId)},{default:l(()=>[c("上传原型")]),_:2},1032,["onClick"])),[[S,["project:mockup:release:add"]]]),M((f(),v(o,{onClick:r=>de(i.mockupId)},{default:l(()=>[c("修改")]),_:2},1032,["onClick"])),[[S,["project:mockup:edit"]]]),M((f(),v(o,{onClick:r=>re(i.mockupId),type:"danger"},{default:l(()=>[c("删除")]),_:2},1032,["onClick"])),[[S,["project:mockup:remove"]]]),s(o,{onClick:r=>_e(i.versions)},{default:l(()=>[c("展开/收起")]),_:2},1032,["onClick"])])])]),default:l(()=>[!i.versions||i.versions.length===0?(f(),V("div",Le," 暂无原型，请上传版本后查看 ")):(f(!0),V(ae,{key:1},le(i.versions,(r,G)=>(f(),V("div",{key:G,class:"version-item"},[a("div",{class:"version-header",onClick:C=>X(r)},[a("span",{class:Ie(["version-number",{latest:te(r,i.versions)}])},[c(P(r.title)+" ",1),te(r,i.versions)?(f(),V("span",He,"latest")):q("",!0)],2),a("div",Te,[s(o,{onClick:Z(C=>X(r),["stop"])},{default:l(()=>[c(P(r.isExpanded?"收起":"展开"),1)]),_:2},1032,["onClick"])])],8,Oe),a("div",Ae,[a("div",Je,[a("p",null,"版本: "+P(r.version),1),a("p",null,"发布:"+P(r.createBy),1),a("p",null,"时间:"+P(r.time),1)])]),r.isExpanded?(f(),V("div",Ge,[a("div",null,[Ke,a("pre",null,P(r.description),1)]),a("div",Qe,[We,a("div",Xe,[a("ul",null,[a("li",Ye,[et,a("div",tt,[a("a",{href:"#",onClick:Z(C=>pe(r),["prevent"]),class:"file-link"},P(r.rpZipName||"无"),9,at),lt,r.htmlFilePath?(f(),v(o,{key:0,onClick:C=>H(r),size:"small"},{default:l(()=>[c("下载")]),_:2},1032,["onClick"])):q("",!0)])]),a("li",ot,[st,a("div",it,[a("span",null,P(r.rpName||"无"),1),r.prototypeFilePath?(f(),v(o,{key:0,onClick:C=>H(r.prototypeFilePath),size:"small"},{default:l(()=>[c("下载")]),_:2},1032,["onClick"])):q("",!0)])]),a("li",dt,[rt,a("div",ct,[a("span",null,P(r.docName||"无"),1),r.requirementsFilePath?(f(),v(o,{key:0,onClick:C=>H(r.requirementsFilePath),size:"small"},{default:l(()=>[c("下载")]),_:2},1032,["onClick"])):q("",!0)])]),a("li",nt,[pt,a("div",ut,[a("span",null,P(r.picName||"无"),1),r.effectPictureFilePath?(f(),v(o,{key:0,onClick:C=>H(r.effectPictureFilePath),size:"small"},{default:l(()=>[c("下载")]),_:2},1032,["onClick"])):q("",!0)])])])])]),a("div",mt,[M((f(),v(o,{icon:"Edit",onClick:Z(C=>ue(G,r),["stop"])},{default:l(()=>[c(" 编辑")]),_:2},1032,["onClick"])),[[S,["project:mockup:release:edit"]]]),M((f(),v(o,{icon:"Delete",type:"danger",onClick:Z(C=>he(G,r),["stop"])},{default:l(()=>[c(" 删除")]),_:2},1032,["onClick"])),[[S,["project:mockup:release:remove"]]])])])):q("",!0)]))),128))]),_:2},1024))),128))]),s(D,{modelValue:d(U),"onUpdate:modelValue":t[2]||(t[2]=i=>K(U)?U.value=i:null),title:"新增原型",width:"30%"},{footer:l(()=>[a("span",ft,[s(o,{onClick:t[1]||(t[1]=i=>U.value=!1)},{default:l(()=>[c("取消")]),_:1}),s(o,{type:"primary",onClick:Y},{default:l(()=>[c("确定")]),_:1})])]),default:l(()=>[s(u,{model:d(b),rules:d(Q),ref_key:"formRef",ref:x,"label-width":"80px","label-position":"top",onSubmit:Z(Y,["prevent"])},{default:l(()=>[s(p,{label:"原型名称",prop:"mockupName"},{default:l(()=>[s(_,{modelValue:d(b).mockupName,"onUpdate:modelValue":t[0]||(t[0]=i=>d(b).mockupName=i),placeholder:"请输入原型名称",style:{width:"100%"}},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue"]),s(D,{modelValue:d(R),"onUpdate:modelValue":t[5]||(t[5]=i=>K(R)?R.value=i:null),title:"编辑原型",width:"30%"},{footer:l(()=>[a("span",ht,[s(o,{onClick:t[4]||(t[4]=i=>R.value=!1)},{default:l(()=>[c("取消")]),_:1}),s(o,{type:"primary",onClick:ee},{default:l(()=>[c("确定")]),_:1})])]),default:l(()=>[s(u,{model:d(b),rules:d(Q),ref_key:"formRef",ref:x,"label-width":"80px","label-position":"top",onSubmit:Z(ee,["prevent"])},{default:l(()=>[s(p,{label:"原型名称",prop:"mockupName"},{default:l(()=>[s(_,{modelValue:d(b).mockupName,"onUpdate:modelValue":t[3]||(t[3]=i=>d(b).mockupName=i),placeholder:"请输入原型名称",style:{width:"100%"}},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue"]),s(D,{title:d(n).title,modelValue:d(n).open,"onUpdate:modelValue":t[8]||(t[8]=i=>d(n).open=i),width:"900px","append-to-body":"","before-close":J},{footer:l(()=>[a("div",Pt,[s(o,{onClick:J},{default:l(()=>[c("取消")]),_:1}),s(o,{type:"primary",icon:"UploadFilled",onClick:ne,"native-type":"button"},{default:l(()=>[c("提交上传")]),_:1})])]),default:l(()=>[a("div",_t,[s(u,{ref_key:"formRef",ref:x,model:d(n).data,rules:d(oe),"label-width":"100px"},{default:l(()=>[s(p,{label:"标题",prop:"name"},{default:l(()=>[s(_,{modelValue:d(n).data.name,"onUpdate:modelValue":t[6]||(t[6]=i=>d(n).data.name=i),placeholder:"请输入标题",style:{width:"100%"}},null,8,["modelValue"])]),_:1}),s(p,{label:"发布说明",prop:"description"},{default:l(()=>[s(_,{modelValue:d(n).data.desc,"onUpdate:modelValue":t[7]||(t[7]=i=>d(n).data.desc=i),type:"textarea",rows:4,placeholder:"请输入发布说明",style:{width:"100%"}},null,8,["modelValue"])]),_:1}),s(p,{label:"原型HTML",prop:"rpZipPath"},{default:l(()=>[s(E,{ref:"htmlUploadRef",limit:1,accept:".zip",headers:d(n).headers,action:d(n).htmlUrl,"on-success":(i,F)=>O(i,F,"html"),"auto-upload":!0,class:"custom-upload"},{tip:l(()=>[gt]),default:l(()=>[s(o,{type:"primary"},{default:l(()=>[c("选择文件")]),_:1})]),_:1},8,["headers","action","on-success"])]),_:1}),s(p,{label:"原型RP"},{default:l(()=>[s(E,{ref:"rpUploadRef",limit:1,accept:".zip,.rp",headers:d(n).headers,action:d(n).fileUrl,"on-success":(i,F)=>O(i,F,"rp"),"auto-upload":!0},{tip:l(()=>[kt]),default:l(()=>[s(o,null,{default:l(()=>[c("选择文件")]),_:1})]),_:1},8,["headers","action","on-success"])]),_:1}),s(p,{label:"需求文件"},{default:l(()=>[s(E,{ref:"requirementUploadRef",limit:1,accept:".doc,.docx,.pdf,.zip",headers:d(n).headers,action:d(n).fileUrl,"on-success":(i,F)=>O(i,F,"requirement"),"auto-upload":!0},{tip:l(()=>[yt]),default:l(()=>[s(o,null,{default:l(()=>[c("选择文件")]),_:1})]),_:1},8,["headers","action","on-success"])]),_:1}),s(p,{label:"效果图"},{default:l(()=>[s(E,{ref:"imageUploadRef",limit:1,accept:".zip",headers:d(n).headers,action:d(n).fileUrl,"on-success":(i,F)=>O(i,F,"image"),"auto-upload":!0},{tip:l(()=>[vt]),default:l(()=>[s(o,null,{default:l(()=>[c("选择文件")]),_:1})]),_:1},8,["headers","action","on-success"])]),_:1})]),_:1},8,["model","rules"])])]),_:1},8,["title","modelValue"]),s(D,{modelValue:d($),"onUpdate:modelValue":t[12]||(t[12]=i=>K($)?$.value=i:null),title:"编辑",width:"30%","before-close":fe},{footer:l(()=>[a("span",bt,[s(o,{onClick:t[11]||(t[11]=i=>$.value=!1)},{default:l(()=>[c("取消")]),_:1}),s(o,{type:"primary",onClick:me},{default:l(()=>[c("确定")]),_:1})])]),default:l(()=>[s(u,{model:d(k),rules:se,ref_key:"editDescriptionFormRef",ref:W,"label-position":"top","label-width":"120px"},{default:l(()=>[s(p,{label:"标题",prop:"title"},{default:l(()=>[s(_,{modelValue:d(k).title,"onUpdate:modelValue":t[9]||(t[9]=i=>d(k).title=i),placeholder:"请输入标题",style:{width:"100%"}},null,8,["modelValue"])]),_:1}),s(p,{label:"发布说明",prop:"description"},{default:l(()=>[s(_,{modelValue:d(k).uploadDescription,"onUpdate:modelValue":t[10]||(t[10]=i=>d(k).uploadDescription=i),type:"textarea",rows:4,placeholder:"请输入发布说明",style:{width:"100%"}},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])])}}}),It=ge(Ft,[["__scopeId","data-v-b6bacf88"]]);export{It as default};
