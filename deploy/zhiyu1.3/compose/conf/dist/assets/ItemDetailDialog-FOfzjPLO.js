import{l as Et}from"./projectUser-CylPsKmU.js";import{D as U,_ as Ze,r as d,B as A,w as Ye,f as k,M as Me,N as L,c as b,o as p,k as I,l as h,h as t,j as o,i as e,p as n,t as g,y as et,z as tt,e as St,J as se,G as Rt,R as Nt,m as R,af as Oe,ag as xe,ah as xt,H as Ae,I as Be,P as Qe,ai as Mt,aj as Ft,ak as Lt,a9 as Ut,X as Pt}from"./index-CR6ovanu.js";import{d as jt,g as zt}from"./tasks-mvyL4cZG.js";import Ot from"./CreateTaskDialog-BiJjOoei.js";import At from"./StartTaskDialog-DQv5ARtA.js";function Bt(u){return U({url:`/task/item/get/${u}`,method:"get"})}function Yt(u,C){return U({url:`/task/item/${u}/priority`,method:"put",data:C})}function Gt(u,C){return U({url:`/task/item/${u}/assignee`,method:"put",data:C})}function qt(u,C){return U({url:`/task/item/${u}/deadline`,method:"put",data:C})}function Wt(u,C){return U({url:`/task/item/${u}/description`,method:"put",data:C})}function _a(u){return U({url:"/task/item/assigned-list",method:"get",params:u})}function ga(u){return U({url:"/task/item/review-list",method:"get",params:u})}function Ht(u){return U({url:"/project/board/taskItems/complete",method:"post",data:u})}function Kt(u){return U({url:"/project/board/taskItems/review",method:"post",data:u})}function Jt(u){return U({url:"/project/board/taskItems/skip",method:"post",data:u})}const lt=u=>(et("data-v-6ed9ae3b"),u=u(),tt(),u),Xt={class:"task-detail"},Qt={key:0,class:"task-detail-content"},Zt={class:"task-header"},el={class:"task-type-tags"},tl={class:"task-id-text"},ll={key:0,class:"navigation-buttons"},al={class:"task-title"},sl={class:"task-description"},ol=lt(()=>o("h3",null,"任务说明",-1)),il={class:"description-content"},nl={key:0,class:"task-items"},dl=lt(()=>o("h3",null,"任务项",-1)),rl={key:1,class:"task-actions"},ul={key:1,class:"empty-state"},cl={class:"dialog-footer"},ml={__name:"TaskDetail",props:{taskId:{type:[Number,String],required:!0},showActions:{type:Boolean,default:!0},showNavigation:{type:Boolean,default:!1},taskList:{type:Array,default:()=>[]}},emits:["refresh","edit","delete","close","back","navigate"],setup(u,{emit:C}){const r=u,f=C,w=d(!1),m=d(null),E=d(!1),S=d(!1),B=d(!1),K=d(!1),N=d(!1),P=d(null),j=A(()=>!r.taskList||r.taskList.length===0||!m.value?-1:r.taskList.findIndex(c=>c.taskId===m.value.task.taskId)),D=A(()=>j.value>0),ke=A(()=>j.value>=0&&j.value<r.taskList.length-1),J=async()=>{if(r.taskId)try{w.value=!0;const c=await zt(r.taskId);c.code===200&&(m.value=c.data)}catch(c){console.error("获取任务详情失败:",c)}finally{w.value=!1}};Ye(()=>r.taskId,c=>{console.log("taskId 变化:",c),J()},{immediate:!0}),Ye(()=>r.taskList,c=>{console.log("任务列表:",r.taskList),console.log("TaskDetail 接收到的任务列表:",c)},{immediate:!0,deep:!0});const de=()=>{if(D.value&&r.taskList.length>0){const c=r.taskList[j.value-1];console.log("导航到上一个任务:",c),f("navigate",c)}},ye=()=>{if(ke.value&&r.taskList.length>0){const c=r.taskList[j.value+1];console.log("导航到下一个任务:",c),f("navigate",c)}},T=c=>c?new Date(c).toLocaleDateString("zh-CN"):"无",Fe=c=>({0:"success",1:"primary",2:"danger",3:"info",4:"info"})[c]||"info",Le=c=>({待处理:"info",进行中:"primary",已完成:"success",已取消:"danger"})[c]||"info",re=c=>({NOT_STARTED:"未分配",IN_PROGRESS:"进行中",COMPLETED_UNCONFIRMED:"已提交待审核",CONFIRMED:"已完成",SKIPPED:"已跳过"})[c]||"未开始",i=c=>({UNASSIGNED:"info",IN_PROGRESS:"primary",PAUSED:"warning",COMPLETED_UNCONFIRMED:"warning",CONFIRMED:"success",SKIPPED:"warning"})[c]||"info",x=()=>{E.value=!0},he=c=>{E.value=!1,c.isEdit&&(J(),f("refresh"))},Ie=()=>{S.value=!0},ue=c=>{S.value=!1,J(),f("refresh"),f("close")},be=()=>{B.value=!0},we=async()=>{try{K.value=!0;const c=await jt(m.value.task.taskId);c.code===200?(ElMessage.success("删除成功"),B.value=!1,f("delete"),f("refresh")):ElMessage.error(c.msg||"删除失败")}catch{ElMessage.error("删除任务失败")}finally{K.value=!1}},Ue=c=>{P.value=c,N.value=!0},oe=c=>{N.value=!1,J(),f("refresh")},De=()=>{f("close")};return(c,y)=>{var Ce,Te,Ve,ne,me,G,q;const ie=k("el-tag"),V=k("el-button"),M=k("el-descriptions-item"),Pe=k("el-progress"),F=k("el-descriptions"),z=k("el-table-column"),je=k("el-table"),X=k("el-empty"),ce=k("el-dialog"),Y=Me("hasPermi"),$=Me("loading");return L((p(),b("div",Xt,[m.value?(p(),b("div",Qt,[o("div",Zt,[o("div",el,[t(ie,{type:Fe(m.value.task.taskType),size:"small"},{default:e(()=>[n(g(m.value.taskTypeLabel),1)]),_:1},8,["type"]),o("span",tl,"#"+g(m.value.task.taskId),1)]),u.showNavigation?(p(),b("div",ll,[t(V,{onClick:de,size:"small",disabled:!D.value},{default:e(()=>[n(" 上一个 ")]),_:1},8,["disabled"]),t(V,{onClick:ye,size:"small",disabled:!ke.value},{default:e(()=>[n(" 下一个 ")]),_:1},8,["disabled"])])):h("",!0)]),o("div",al,[o("h2",null,g(m.value.task.taskName),1)]),t(F,{column:2,border:"",size:"small","label-width":"180px"},{default:e(()=>[t(M,{label:"状态"},{default:e(()=>[t(ie,{type:Le(m.value.task.status)},{default:e(()=>[n(g(m.value.task.status),1)]),_:1},8,["type"])]),_:1}),t(M,{label:"创建时间"},{default:e(()=>[n(g(m.value.task.createTime),1)]),_:1}),t(M,{label:"预计完成"},{default:e(()=>[n(g(T(m.value.task.deadline)),1)]),_:1}),t(M,{label:"实际完成"},{default:e(()=>[n(g(m.value.task.completedDate?T(m.value.task.completedDate):"未完成"),1)]),_:1}),t(M,{label:"完成度"},{default:e(()=>[t(Pe,{percentage:m.value.completionRate,status:m.value.completionRate===100?"success":"","stroke-width":10},null,8,["percentage","status"])]),_:1}),t(M,{label:"完成项数"},{default:e(()=>[n(g(m.value.completedItems||0),1)]),_:1}),t(M,{label:"创建者"},{default:e(()=>[n(g(m.value.task.createBy||"未知"),1)]),_:1})]),_:1}),o("div",sl,[ol,o("div",il,g(m.value.task.description||"无"),1)]),m.value.stagesWithItems&&m.value.stagesWithItems.length>0?(p(),b("div",nl,[dl,t(je,{data:m.value.stagesWithItems,border:""},{default:e(()=>[t(z,{prop:"stageName",label:"流程",width:"100"}),t(z,{prop:"status",label:"状态",width:"120"},{default:e(_=>[t(ie,{type:i(_.row.status)},{default:e(()=>[n(g(re(_.row.status)),1)]),_:2},1032,["type"])]),_:1}),t(z,{prop:"assignToName",label:"负责人",width:"120",align:"center"}),t(z,{prop:"startDate",label:"开始日期",width:"98",align:"center"}),t(z,{prop:"deadDate",label:"预计完成",align:"center"}),t(z,{prop:"actualEndDate",label:"实际完成",width:"120",align:"center"}),t(z,{prop:"",label:"查看",align:"center"},{default:e(_=>[_.row.itemId?(p(),I(V,{key:0,type:"primary",size:"small",onClick:pe=>Ue(_.row),disabled:!_.row.itemId},{default:e(()=>[n(" 详情 ")]),_:2},1032,["onClick","disabled"])):h("",!0)]),_:1})]),_:1},8,["data"])])):h("",!0),u.showActions?(p(),b("div",rl,[m.value.statusCode!==2?L((p(),I(V,{key:0,type:"danger",onClick:be},{default:e(()=>[n("删除")]),_:1})),[[Y,["project:task:del"]]]):h("",!0),m.value.statusCode!==2?L((p(),I(V,{key:1,type:"primary",onClick:x},{default:e(()=>[n("编辑")]),_:1})),[[Y,["project:task:edit"]]]):h("",!0),m.value.statusCode===2?L((p(),I(V,{key:2,type:"primary",onClick:x},{default:e(()=>[n("归档")]),_:1})),[[Y,["project:task:record"]]]):h("",!0),m.value.statusCode===0||m.value.statusCode===3?L((p(),I(V,{key:3,type:"success",onClick:Ie},{default:e(()=>[n(" 启动 ")]),_:1})),[[Y,["project:task:start"]]]):h("",!0),t(V,{onClick:De},{default:e(()=>[n("关闭")]),_:1})])):h("",!0)])):(p(),b("div",ul,[t(X,{description:"暂无任务详情"})])),E.value?(p(),I(Ot,{key:2,visible:E.value,"onUpdate:visible":y[0]||(y[0]=_=>E.value=_),"project-id":(Te=(Ce=m.value)==null?void 0:Ce.task)==null?void 0:Te.projectId,"task-id":(ne=(Ve=m.value)==null?void 0:Ve.task)==null?void 0:ne.taskId,onSuccess:he,onClose:y[1]||(y[1]=_=>E.value=!1)},null,8,["visible","project-id","task-id"])):h("",!0),S.value?(p(),I(At,{key:3,visible:S.value,"onUpdate:visible":y[2]||(y[2]=_=>S.value=_),task:(me=m.value)==null?void 0:me.task,onSuccess:ue,onClose:y[3]||(y[3]=_=>S.value=!1)},null,8,["visible","task"])):h("",!0),t(ce,{modelValue:B.value,"onUpdate:modelValue":y[5]||(y[5]=_=>B.value=_),title:"确认删除",width:"500px"},{footer:e(()=>[o("div",cl,[t(V,{onClick:y[4]||(y[4]=_=>B.value=!1)},{default:e(()=>[n("取消")]),_:1}),t(V,{type:"danger",onClick:we,loading:K.value},{default:e(()=>[n("确定")]),_:1},8,["loading"])])]),default:e(()=>{var _,pe;return[o("span",null,'确定要删除任务 "'+g((pe=(_=m.value)==null?void 0:_.task)==null?void 0:pe.taskName)+'" 吗？',1)]}),_:1},8,["modelValue"]),N.value&&P.value?(p(),I(ot,{key:4,visible:N.value,"onUpdate:visible":y[6]||(y[6]=_=>N.value=_),"item-id":P.value.itemId,"project-id":(q=(G=m.value)==null?void 0:G.task)==null?void 0:q.projectId,onClose:y[7]||(y[7]=_=>N.value=!1),onSuccess:oe,onRefresh:J},null,8,["visible","item-id","project-id"])):h("",!0)])),[[$,w.value]])}}},at=Ze(ml,[["__scopeId","data-v-6ed9ae3b"]]),ka=Object.freeze(Object.defineProperty({__proto__:null,default:at},Symbol.toStringTag,{value:"Module"})),st={__name:"TaskDetailDialog",props:{visible:{type:Boolean,default:!1},taskId:{type:[Number,String,null],default:null},taskData:{type:Object,default:null},showActions:{type:Boolean,default:!0},showNavigation:{type:Boolean,default:!1},taskList:{type:Array,default:()=>[]}},emits:["update:visible","refresh","close","navigate"],setup(u,{emit:C}){const r=C,f=()=>{r("update:visible",!1),r("close")},w=m=>{r("navigate",m)};return(m,E)=>{const S=k("el-dialog");return p(),I(S,{"model-value":u.visible,title:"任务详情",width:"900px","close-on-click-modal":!1,onClose:f},{default:e(()=>[t(at,{"task-id":u.taskId,"task-data":u.taskData,"show-actions":u.showActions,"show-navigation":u.showNavigation,"task-list":u.taskList,onRefresh:E[0]||(E[0]=B=>r("refresh")),onDelete:f,onClose:f,onNavigate:w},null,8,["task-id","task-data","show-actions","show-navigation","task-list"])]),_:1},8,["model-value"])}}},ya=Object.freeze(Object.defineProperty({__proto__:null,default:st},Symbol.toStringTag,{value:"Module"})),ge=u=>(et("data-v-9ce81cdc"),u=u(),tt(),u),pl={class:"item-detail-dialog-wrapper"},vl={class:"dialog-header"},fl={class:"dialog-title"},_l={class:"header-actions"},gl={class:"item-detail-container"},kl={key:0,class:"detail-content"},yl={class:"item-section"},hl={class:"item-header"},Il={class:"item-name-container"},bl={class:"task-name"},wl={class:"stage-name"},Dl={class:"section-header"},Cl=ge(()=>o("span",{class:"section-title"},"基本信息",-1)),Tl={class:"section-content"},Vl={class:"field-with-action"},$l={class:"field-with-action"},El={class:"field-with-action"},Sl={class:"field-with-action"},Rl={class:"item-section"},Nl={class:"section-header"},xl=ge(()=>o("span",{class:"section-title"},"任务描述",-1)),Ml={class:"section-content description-container"},Fl={class:"description-text"},Ll={class:"description-actions"},Ul={key:0,class:"item-section"},Pl={class:"section-header"},jl=ge(()=>o("span",{class:"section-title"},"完成报告",-1)),zl={class:"section-content"},Ol={class:"description-text"},Al={class:"item-section"},Bl={class:"section-header"},Yl=ge(()=>o("span",{class:"section-title"},"操作历史",-1)),Gl={class:"section-content"},ql={class:"event-timeline"},Wl={class:"timeline-content"},Hl={class:"event-header"},Kl={class:"event-time"},Jl={class:"event-operator"},Xl={class:"event-content"},Ql=ge(()=>o("span",{class:"event-action"},"进行了:",-1)),Zl={class:"event-description"},ea={key:0,class:"no-events"},ta={key:1,class:"empty-detail"},la={class:"dialog-footer"},aa={class:"dialog-footer"},sa={class:"dialog-footer"},oa={class:"dialog-footer"},ia={class:"dialog-footer"},na={class:"dialog-footer"},da={class:"dialog-footer"},ra={class:"dialog-footer"},ua={__name:"ItemDetailDialog",props:{visible:{type:Boolean,default:!1},itemId:{type:Number,default:null},projectId:{type:[Number,String],default:null}},emits:["update:visible","close","success"],setup(u,{emit:C}){const{proxy:r}=St(),f=u,w=C,m=A({get:()=>f.visible,set:a=>{w("update:visible",a)}}),E=A(()=>{var a;return(a=i.value)!=null&&a.itemName?`#${i.value.itemId}的 #${i.value.taskTypeLabel} 事项`:"工作详情"}),S=d(!1),B=d(!1),K=d(!1),N=d(!1),P=d(!1),j=d(null),D=se({itemId:null,completeTime:"",report:""}),ke={completeTime:[{required:!0,message:"请选择实际完成时间",trigger:"change"}]},J=a=>({0:"低",1:"中",2:"高",3:"紧急"})[a]||"未知优先级",de=a=>({0:"info",1:"primary",2:"warning",3:"danger"})[a]||"info",ye=a=>{const l={LOW:0,MEDIUM:1,HIGH:2,URGENT:3};return l[a]!==void 0?l[a]:a},T=a=>{const l={NOT_STARTED:0,IN_PROGRESS:1,COMPLETED_UNCONFIRMED:2,SKIPPED:3,CONFIRMED:4};return l[a]!==void 0?l[a]:a},Fe=a=>({0:"未开始",1:"进行中",2:"已完成待确认",3:"已略过",4:"已完成"})[a]||"未知状态",Le=a=>({0:"info",1:"primary",2:"warning",3:"danger",4:"success"})[a]||"info",re=a=>{if(!a)return"无";if(a instanceof Date)return a.toLocaleDateString("zh-CN");if(typeof a=="string"){if(a.match(/^\d{4}-\d{2}-\d{2}$/)){const[l,v,Se]=a.split("-");return`${l}-${v}-${Se}`}if(a.match(/^\d{4}-\d{2}-\d{2} \d{2}:\d{2}:\d{2}$/))return a.substring(0,16).replace(" "," ")}return a},i=d(null),x=d([]),he=d(""),Ie=d(""),ue=d(""),be=d(0),we=d(""),Ue=()=>{N.value=!N.value},oe=d(!1),De=d(null),c=async()=>{i.value&&i.value.taskId&&(De.value=i.value.taskId,await Pt(),oe.value=!0)},y=d(!1),ie=d(!1),V=d(!1),M=d(!1),Pe=a=>({0:"success",1:"primary",2:"danger",3:"info",4:"info"})[a]||"info",F=async a=>{try{S.value=!0;const l=await Bt(a);l.code===200?(i.value=l.data.item,x.value=l.data.events||[],he.value=l.data.taskName||"",Ie.value=l.data.assignToName||"",Ge.value=l.data.projectId||null,ue.value=l.data.taskTypeLabel||"",be.value=l.data.taskType,we.value=l.data.stageName||"",y.value=l.data.isEditRole===!0,ie.value=l.data.isCompleteRole===!0,V.value=l.data.isSkipRole===!0,M.value=l.data.isReviewRole===!0):r.$modal.msgError(l.msg||"获取任务详情失败")}catch(l){console.error("获取任务详情失败:",l),r.$modal.msgError("获取任务详情失败: "+(l.message||""))}finally{S.value=!1}};Ye(()=>f.itemId,a=>{a?F(a):(i.value=null,x.value=[])},{immediate:!0});const z=()=>{i.value&&(D.itemId=i.value.itemId||i.value.id,D.completeTime=new Date().toISOString().split("T")[0],D.report=i.value.report||"",P.value=!0)},je=async()=>{j.value&&await j.value.validate(async a=>{if(a)try{K.value=!0;const l={itemId:D.itemId,completeTime:D.completeTime,report:D.report},v=await Ht(l);v.code===200?(P.value=!1,r.$modal.msgSuccess("任务完成成功"),w("success",v),f.itemId&&F(f.itemId)):r.$modal.msgError(v.msg||"任务项完成失败")}catch(l){console.error("完成任务项失败:",l),r.$modal.msgError("任务项完成失败: "+(l.message||""))}finally{K.value=!1}})},X=d(!1),ce=d(null),Y=d(!1),$=se({taskItemId:null,approved:null,comment:""}),Ce={approved:[{required:!0,message:"请选择审核结果",trigger:"change"}]},Te=()=>{i.value&&($.taskItemId=i.value.itemId||i.value.id,$.approved=!0,$.comment="",X.value=!0)},Ve=async()=>{ce.value&&await ce.value.validate(async a=>{if(a)try{Y.value=!0;const l=await Kt({taskItemId:$.taskItemId,approved:$.approved,comment:$.comment});l.code===200?(X.value=!1,r.$modal.msgSuccess("任务审核成功"),w("success",l),f.itemId&&F(f.itemId)):r.$modal.msgError(l.msg||"任务项审核失败")}catch(l){console.error("审核任务项失败:",l),r.$modal.msgError("任务项审核失败: "+(l.message||""))}finally{Y.value=!1}})},ne=()=>{w("close")},me=()=>{};Rt(()=>{window.addEventListener("resize",me)}),Nt(()=>{window.removeEventListener("resize",me)});const G=d(!1),q=d(!1),_=d(!1),pe=d(null),it=d(null),nt=d(null),Ge=d(null),Q=se({itemId:null,level:""}),Z=se({itemId:null,deadline:""}),ee=se({itemId:null,assigneeId:""}),dt=[{value:0,label:"低"},{value:1,label:"中"},{value:2,label:"高"},{value:3,label:"紧急"}],qe=d([]),rt=()=>{i.value&&(Q.itemId=i.value.itemId||i.value.id,Q.level=ye(i.value.level),G.value=!0)},ut=()=>{i.value&&(Z.itemId=i.value.itemId||i.value.id,Z.deadline=i.value.deadDate||"",q.value=!0)},ct=()=>{i.value&&(ee.itemId=i.value.itemId||i.value.id,ee.assigneeId=i.value.assignToId||"",mt(),_.value=!0)};function mt(){Et(Ge.value).then(a=>{a.code===200&&(qe.value=a.data)}).finally(()=>{})}const pt=async()=>{try{const a=await Yt(Q.itemId,Q.level);a.code===200?(r.$modal.msgSuccess("优先级修改成功"),w("success",a),G.value=!1,f.itemId&&F(f.itemId)):r.$modal.msgError(a.msg||"优先级修改失败")}catch(a){console.error("优先级修改失败:",a),r.$modal.msgError("优先级修改失败: "+(a.message||""))}},vt=async()=>{try{const a=await qt(Z.itemId,Z.deadline);a.code===200?(r.$modal.msgSuccess("截止日期修改成功"),q.value=!1,w("success",a),f.itemId&&F(f.itemId)):r.$modal.msgError(a.msg||"截止日期修改失败")}catch(a){console.error("截止日期修改失败:",a),r.$modal.msgError("截止日期修改失败: "+(a.message||""))}},ft=async()=>{try{const a=await Gt(ee.itemId,ee.assigneeId);a.code===200?(r.$modal.msgSuccess("负责人修改成功"),_.value=!1,w("success",a),f.itemId&&F(f.itemId)):r.$modal.msgError(a.msg||"负责人修改失败")}catch(a){console.error("负责人修改失败:",a),r.$modal.msgError("负责人修改失败: "+(a.message||""))}},ve=d(!1),_t=d(null),te=se({itemId:null,description:""}),gt=()=>{i.value&&(te.itemId=i.value.itemId||i.value.id,te.description=i.value.description||"",ve.value=!0)},kt=async()=>{try{const a=await Wt(te.itemId,te.description);a.code===200?(r.$modal.msgSuccess("任务描述修改成功"),ve.value=!1,f.itemId&&F(f.itemId)):r.$modal.msgError(a.msg||"任务描述修改失败")}catch(a){console.error("任务描述修改失败:",a),r.$modal.msgError("任务描述修改失败: "+(a.message||""))}},$e=d(!1),fe=d(!1),ze=d(null),le=se({taskItemId:null,reason:""}),yt={reason:[{required:!0,message:"请输入跳过原因",trigger:"blur"}]},ht=()=>{i.value&&(le.taskItemId=i.value.itemId||i.value.id,le.reason="",fe.value=!0)},It=async()=>{ze.value&&await ze.value.validate(async a=>{if(a)try{$e.value=!0;const l=await Jt({taskItemId:le.taskItemId,reason:le.reason});l.code===200?(r.$modal.msgSuccess("任务项跳过成功"),fe.value=!1,w("success",l),f.itemId&&F(f.itemId)):r.$modal.msgError(l.msg||"任务项跳过失败")}catch(l){console.error("跳过任务项失败:",l),r.$modal.msgError("任务项跳过失败: "+(l.message||""))}finally{$e.value=!1}})},Ee=A(()=>y.value),bt=A(()=>ie.value),wt=A(()=>V.value),Dt=A(()=>M.value);return(a,l)=>{const v=k("el-button"),Se=k("el-tag"),W=k("el-icon"),_e=k("el-descriptions-item"),Ct=k("el-descriptions"),Tt=k("el-empty"),H=k("el-dialog"),We=k("el-date-picker"),O=k("el-form-item"),Re=k("el-input"),ae=k("el-form"),He=k("el-radio"),Vt=k("el-radio-group"),Ke=k("el-option"),Je=k("el-select"),Ne=Me("hasPermi"),$t=Me("loading");return p(),b("div",pl,[t(H,{title:E.value,modelValue:m.value,"onUpdate:modelValue":l[0]||(l[0]=s=>m.value=s),width:"850px","close-on-click-modal":!1,"show-close":!1,onClose:ne,class:"task-detail-dialog",fullscreen:N.value},{header:e(()=>[o("div",vl,[o("span",fl,g(E.value),1),o("div",_l,[t(v,{icon:R(Mt),onClick:Ue,text:"",size:"small",class:"fullscreen-btn"},{default:e(()=>[n(" 全屏切换 ")]),_:1},8,["icon"]),i.value&&i.value.taskId?(p(),I(v,{key:0,icon:R(Ft),onClick:c,text:"",size:"small",title:"所属任务"},{default:e(()=>[n(" 任务信息 ")]),_:1},8,["icon"])):h("",!0),t(v,{icon:R(Lt),onClick:ne,text:"",size:"small",title:"关闭"},{default:e(()=>[n(" 关闭 ")]),_:1},8,["icon"])])])]),footer:e(()=>[o("div",la,[wt.value&&T(i.value.status)<2?(p(),I(v,{key:0,type:"danger",onClick:ht,loading:$e.value},{default:e(()=>[n(" 跳过任务 ")]),_:1},8,["loading"])):h("",!0),bt.value&&T(i.value.status)<2?(p(),I(v,{key:1,type:"primary",onClick:z,loading:B.value},{default:e(()=>[n(" 完成任务 ")]),_:1},8,["loading"])):h("",!0),Dt.value&&T(i.value.status)===2?(p(),I(v,{key:2,type:"success",onClick:Te},{default:e(()=>[n(" 审核任务 ")]),_:1})):h("",!0),t(v,{onClick:ne},{default:e(()=>[n("关闭")]),_:1})])]),default:e(()=>[L((p(),b("div",gl,[i.value?(p(),b("div",kl,[o("div",yl,[o("div",hl,[o("div",Il,[ue.value?(p(),I(Se,{key:0,type:Pe(be.value),size:"small",class:"task-type-tag"},{default:e(()=>[n(g(ue.value),1)]),_:1},8,["type"])):h("",!0),o("div",bl,g(he.value),1),o("div",wl,g(we.value),1)])]),o("div",Dl,[t(W,null,{default:e(()=>[t(R(Oe))]),_:1}),Cl]),o("div",Tl,[t(Ct,{column:2,border:"",size:"small","label-width":"180px"},{default:e(()=>[t(_e,{label:"状态"},{default:e(()=>[t(Se,{type:Le(T(i.value.status)),size:"small"},{default:e(()=>[n(g(Fe(T(i.value.status))),1)]),_:1},8,["type"])]),_:1}),t(_e,{label:"开始日期"},{default:e(()=>[o("div",Vl,[o("span",null,g(re(i.value.startDate)||"未设置"),1)])]),_:1}),t(_e,{label:"优先级"},{default:e(()=>[o("div",$l,[n(g(J(ye(i.value.level)))+" ",1),Ee.value&&T(i.value.status)<2?L((p(),I(v,{key:0,text:"",size:"small",onClick:rt,class:"field-edit-btn"},{default:e(()=>[t(W,null,{default:e(()=>[t(R(xe))]),_:1})]),_:1})),[[Ne,["task:item:edit"]]]):h("",!0)])]),_:1}),t(_e,{label:"计划完成"},{default:e(()=>[o("div",El,[o("span",null,g(re(i.value.deadDate)||"未设置"),1),Ee.value&&T(i.value.status)<2?L((p(),I(v,{key:0,text:"",size:"small",onClick:ut,class:"field-edit-btn"},{default:e(()=>[t(W,null,{default:e(()=>[t(R(xe))]),_:1})]),_:1})),[[Ne,["task:item:edit"]]]):h("",!0)])]),_:1}),t(_e,{label:"负责人"},{default:e(()=>[o("div",Sl,[o("span",null,g(Ie.value||"未分配"),1),Ee.value&&T(i.value.status)<2?L((p(),I(v,{key:0,text:"",size:"small",onClick:ct,class:"field-edit-btn"},{default:e(()=>[t(W,null,{default:e(()=>[t(R(xe))]),_:1})]),_:1})),[[Ne,["task:item:edit"]]]):h("",!0)])]),_:1})]),_:1})])]),o("div",Rl,[o("div",Nl,[t(W,null,{default:e(()=>[t(R(Oe))]),_:1}),xl]),o("div",Ml,[o("p",Fl,g(i.value.description||"无描述"),1),o("div",Ll,[Ee.value&&T(i.value.status)<2?L((p(),I(v,{key:0,text:"",size:"small",onClick:gt,class:"edit-description-btn"},{default:e(()=>[t(W,null,{default:e(()=>[t(R(xe))]),_:1}),n(" 编辑 ")]),_:1})),[[Ne,["task:item:edit"]]]):h("",!0)])])]),T(i.value.status)>=2?(p(),b("div",Ul,[o("div",Pl,[t(W,null,{default:e(()=>[t(R(Oe))]),_:1}),jl]),o("div",zl,[o("p",Ol,g(i.value.report||"无描述"),1)])])):h("",!0),o("div",Al,[o("div",Bl,[t(W,null,{default:e(()=>[t(R(xt))]),_:1}),Yl]),o("div",Gl,[o("div",ql,[(p(!0),b(Ae,null,Be(x.value,(s,Xe)=>(p(),b("div",{key:s.id,class:Qe(["timeline-item",{"timeline-item-last":Xe===x.value.length-1}])},[o("div",{class:Qe(["timeline-marker",{"timeline-marker-last":Xe===x.value.length-1}])},null,2),o("div",Wl,[o("div",Hl,[o("span",Kl,g(re(s.createTime)),1),o("span",Jl,"操作人: "+g(s.operator),1)]),o("div",Xl,[Ql,o("span",Zl,g(s.eventContent),1)])])],2))),128)),!x.value||x.value.length===0?(p(),b("div",ea," 暂无操作记录 ")):h("",!0)])])])])):(p(),b("div",ta,[t(Tt,{description:"暂无任务项详情"})]))])),[[$t,S.value]])]),_:1},8,["title","modelValue","fullscreen"]),t(H,{modelValue:P.value,"onUpdate:modelValue":l[4]||(l[4]=s=>P.value=s),title:"完成任务项",width:"500px","close-on-click-modal":!1},{footer:e(()=>[o("div",aa,[t(v,{onClick:l[3]||(l[3]=s=>P.value=!1)},{default:e(()=>[n("取消")]),_:1}),t(v,{type:"primary",onClick:je,loading:K.value},{default:e(()=>[n(" 确定完成 ")]),_:1},8,["loading"])])]),default:e(()=>[t(ae,{ref_key:"completeFormRef",ref:j,model:D,rules:ke,"label-width":"120px"},{default:e(()=>[t(O,{label:"实际完成时间",prop:"completeTime"},{default:e(()=>[t(We,{modelValue:D.completeTime,"onUpdate:modelValue":l[1]||(l[1]=s=>D.completeTime=s),type:"date",placeholder:"请选择实际完成时间","value-format":"YYYY-MM-DD",style:{width:"100%"}},null,8,["modelValue"])]),_:1}),t(O,{label:"完成报告",prop:"report"},{default:e(()=>[t(Re,{modelValue:D.report,"onUpdate:modelValue":l[2]||(l[2]=s=>D.report=s),type:"textarea",rows:4,placeholder:"请输入完成报告"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"]),t(H,{modelValue:X.value,"onUpdate:modelValue":l[8]||(l[8]=s=>X.value=s),title:"审核任务项",width:"500px","close-on-click-modal":!1},{footer:e(()=>[o("div",sa,[t(v,{onClick:l[7]||(l[7]=s=>X.value=!1)},{default:e(()=>[n("取消")]),_:1}),t(v,{type:"primary",onClick:Ve,loading:Y.value},{default:e(()=>[n(" 确定审核 ")]),_:1},8,["loading"])])]),default:e(()=>[t(ae,{ref_key:"auditFormRef",ref:ce,model:$,rules:Ce,"label-width":"120px"},{default:e(()=>[t(O,{label:"审核结果",prop:"approved"},{default:e(()=>[t(Vt,{modelValue:$.approved,"onUpdate:modelValue":l[5]||(l[5]=s=>$.approved=s)},{default:e(()=>[t(He,{label:!0},{default:e(()=>[n("通过")]),_:1}),t(He,{label:!1},{default:e(()=>[n("不通过")]),_:1})]),_:1},8,["modelValue"])]),_:1}),t(O,{label:"审核意见",prop:"comment"},{default:e(()=>[t(Re,{modelValue:$.comment,"onUpdate:modelValue":l[6]||(l[6]=s=>$.comment=s),type:"textarea",rows:4,placeholder:"请输入审核意见"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"]),t(H,{modelValue:fe.value,"onUpdate:modelValue":l[11]||(l[11]=s=>fe.value=s),title:"跳过任务项",width:"500px","close-on-click-modal":!1},{footer:e(()=>[o("div",oa,[t(v,{onClick:l[10]||(l[10]=s=>fe.value=!1)},{default:e(()=>[n("取消")]),_:1}),t(v,{type:"primary",onClick:It,loading:$e.value},{default:e(()=>[n(" 确定跳过 ")]),_:1},8,["loading"])])]),default:e(()=>[t(ae,{ref_key:"skipFormRef",ref:ze,model:le,rules:yt,"label-width":"120px"},{default:e(()=>[t(O,{label:"跳过原因",prop:"reason"},{default:e(()=>[t(Re,{modelValue:le.reason,"onUpdate:modelValue":l[9]||(l[9]=s=>le.reason=s),type:"textarea",rows:4,placeholder:"请输入跳过原因"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"]),t(st,{visible:oe.value,"onUpdate:visible":l[12]||(l[12]=s=>oe.value=s),"task-id":De.value,"show-actions":!0,"show-navigation":!1,onRefresh:l[13]||(l[13]=s=>a.$emit("refresh")),onClose:l[14]||(l[14]=s=>oe.value=!1)},null,8,["visible","task-id"]),t(H,{modelValue:G.value,"onUpdate:modelValue":l[17]||(l[17]=s=>G.value=s),title:"修改优先级",width:"400px","close-on-click-modal":!1},{footer:e(()=>[o("div",ia,[t(v,{onClick:l[16]||(l[16]=s=>G.value=!1)},{default:e(()=>[n("取消")]),_:1}),t(v,{type:"primary",onClick:pt},{default:e(()=>[n("确定")]),_:1})])]),default:e(()=>[t(ae,{ref_key:"priorityFormRef",ref:pe,model:Q},{default:e(()=>[t(O,{label:"优先级"},{default:e(()=>[t(Je,{modelValue:Q.level,"onUpdate:modelValue":l[15]||(l[15]=s=>Q.level=s),placeholder:"请选择优先级"},{default:e(()=>[(p(),b(Ae,null,Be(dt,s=>t(Ke,{key:s.value,label:s.label,value:s.value,style:Ut({color:de(s.value)==="danger"?"#F56C6C":de(s.value)==="warning"?"#E6A23C":de(s.value)==="primary"?"#409EFF":"#909399"})},null,8,["label","value","style"])),64))]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"]),t(H,{modelValue:q.value,"onUpdate:modelValue":l[20]||(l[20]=s=>q.value=s),title:"修改截止日期",width:"400px","close-on-click-modal":!1},{footer:e(()=>[o("div",na,[t(v,{onClick:l[19]||(l[19]=s=>q.value=!1)},{default:e(()=>[n("取消")]),_:1}),t(v,{type:"primary",onClick:vt},{default:e(()=>[n("确定")]),_:1})])]),default:e(()=>[t(ae,{ref_key:"deadlineFormRef",ref:it,model:Z},{default:e(()=>[t(O,{label:"截止日期"},{default:e(()=>[t(We,{modelValue:Z.deadline,"onUpdate:modelValue":l[18]||(l[18]=s=>Z.deadline=s),type:"date",placeholder:"请选择截止日期","value-format":"YYYY-MM-DD",style:{width:"100%"}},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"]),t(H,{modelValue:_.value,"onUpdate:modelValue":l[23]||(l[23]=s=>_.value=s),title:"修改负责人",width:"400px","close-on-click-modal":!1},{footer:e(()=>[o("div",da,[t(v,{onClick:l[22]||(l[22]=s=>_.value=!1)},{default:e(()=>[n("取消")]),_:1}),t(v,{type:"primary",onClick:ft},{default:e(()=>[n("确定")]),_:1})])]),default:e(()=>[t(ae,{ref_key:"assigneeFormRef",ref:nt,model:ee},{default:e(()=>[t(O,{label:"负责人"},{default:e(()=>[t(Je,{modelValue:ee.assigneeId,"onUpdate:modelValue":l[21]||(l[21]=s=>ee.assigneeId=s),filterable:"",placeholder:"请选择负责人",style:{width:"100%"}},{default:e(()=>[(p(!0),b(Ae,null,Be(qe.value,s=>(p(),I(Ke,{key:s.userId,label:s.nickName,value:s.userId},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"]),t(H,{modelValue:ve.value,"onUpdate:modelValue":l[26]||(l[26]=s=>ve.value=s),title:"修改任务描述",width:"500px","close-on-click-modal":!1},{footer:e(()=>[o("div",ra,[t(v,{onClick:l[25]||(l[25]=s=>ve.value=!1)},{default:e(()=>[n("取消")]),_:1}),t(v,{type:"primary",onClick:kt},{default:e(()=>[n("确定")]),_:1})])]),default:e(()=>[t(ae,{ref_key:"descriptionFormRef",ref:_t,model:te},{default:e(()=>[t(O,null,{default:e(()=>[t(Re,{modelValue:te.description,"onUpdate:modelValue":l[24]||(l[24]=s=>te.description=s),type:"textarea",rows:6,placeholder:"请输入任务描述"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])])}}},ot=Ze(ua,[["__scopeId","data-v-9ce81cdc"]]),ha=Object.freeze(Object.defineProperty({__proto__:null,default:ot},Symbol.toStringTag,{value:"Module"}));export{ot as I,at as T,st as _,ga as a,ka as b,ya as c,ha as d,_a as g};
