import{l as A,d as B}from"./projectUser-CylPsKmU.js";import{_ as M,e as L,r as b,w as W,G as E,f as r,c as v,h as t,k as R,l as q,i as s,j as u,o as _,m as I,ab as k,t as x,ac as z,p as g}from"./index-CR6ovanu.js";import D from"./addMember-DDFozY0Y.js";import"./user-VS3yfzIo.js";const G={class:"main"},F={class:"text item"},H={class:"userImg"},J={class:"demo-image"},K={key:0,class:"block"},O={key:1,class:"block"},Q={__name:"member",props:{projectId:{type:String,required:!0}},emits:["success"],setup(w,{emit:X}){const{proxy:a}=L(),h="/prod-api",i=w,f=b([]),j=b(0),n=b(!1);W(()=>i.projectId,e=>{e&&p()});const C=e=>e?e.startsWith("http://")||e.startsWith("https://")?e:e.startsWith("/")?h+e:h+"/"+e:k,p=async()=>{if(i.projectId)try{const e=await A(i.projectId);e.code===200&&(f.value=e.rows||e.data||[],j.value=e.total||f.value.length||0)}catch(e){console.error("获取项目成员列表失败:",e)}},$=()=>{n.value=!0},U=()=>{n.value=!1,p()},N=async(e,l)=>{try{console.log("删除成员:",l);let c={projectId:i.projectId,userIds:l.userId};const m=await B(c);m.code===200?(console.log("删除成功"),a&&a.$modal?a.$modal.msgSuccess("移除成功"):console.log("proxy 或 $modal 不存在"),p()):a&&a.$modal&&a.$modal.msgError(m.msg||"移除失败")}catch(c){console.error("删除成员失败:",c)}};return E(()=>{i.projectId&&p()}),(e,l)=>{const c=r("el-button"),m=r("el-descriptions-item"),S=r("el-descriptions"),d=r("el-table-column"),y=r("el-image"),T=r("el-table"),V=r("el-card");return _(),v("div",G,[t(V,{class:"box-card cardtwo"},{header:s(()=>[t(S,{title:"项目成员信息"},{extra:s(()=>[t(c,{type:"primary",plain:"",onClick:$},{default:s(()=>[g(" 添加人员 ")]),_:1})]),default:s(()=>[t(m,{label:"项目成员"},{default:s(()=>[g(x(j.value)+"人 ",1)]),_:1})]),_:1})]),default:s(()=>[u("div",F,[t(T,{data:f.value,style:{width:"100%"}},{default:s(()=>[t(d,{prop:"userId",label:"用户Id",align:"center",width:"80"}),t(d,{prop:"avatar",label:"头像",width:"119",align:"center"},{default:s(o=>[u("div",H,[u("div",J,[o.row.avatar&&o.row.avatar!=""?(_(),v("div",K,[t(y,{src:C(o.row.avatar)},null,8,["src"])])):(_(),v("div",O,[t(y,{src:I(k)},null,8,["src"])]))])])]),_:1}),t(d,{prop:"nickName",label:"姓名",align:"center"}),t(d,{prop:"joinTime",label:"加入时间",align:"center"},{default:s(o=>[u("span",null,x(I(z)(o.row.joinTime)),1)]),_:1}),t(d,{fixed:"right",label:"操作",width:"120",align:"center"},{default:s(o=>[t(c,{onClick:Y=>N(o.$index,o.row),type:"danger",link:"",size:"small"},{default:s(()=>[g(" 移除 ")]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])])]),_:1}),n.value?(_(),R(D,{key:0,visible:n.value,"onUpdate:visible":l[0]||(l[0]=o=>n.value=o),"project-id":w.projectId,onSuccess:U,onClose:l[1]||(l[1]=o=>n.value=!1)},null,8,["visible","project-id"])):q("",!0)])}}},oe=M(Q,[["__scopeId","data-v-8bce5c09"]]);export{oe as default};
