import{d as oe,p as ne,g as ie}from"./tasks-mvyL4cZG.js";import ce from"./CreateTaskDialog-BiJjOoei.js";import re from"./StartTaskDialog-DQv5ARtA.js";import{_ as de,e as ue,r as y,w as _e,B as U,f as _,c as I,o as v,k as S,l as C,h as l,j as s,t as c,i as o,p as r,m as V,y as ve,z as pe,X as ke}from"./index-CR6ovanu.js";import"./projectUser-CylPsKmU.js";const p=g=>(ve("data-v-a9b4deeb"),g=g(),pe(),g),me={class:"task-detail"},fe={key:0,class:"task-container"},he={class:"task-header"},ge={class:"navigation-buttons"},be={class:"task-content"},ye={class:"task-title"},Ce={class:"task-attributes"},De={class:"attributes-grid"},Ie={class:"attribute-item"},Se=p(()=>s("span",{class:"label"},"状态:",-1)),Ne={class:"value"},Te={class:"attribute-item"},Ee=p(()=>s("span",{class:"label"},"截止日期:",-1)),we={class:"value"},xe={class:"attribute-item"},Le=p(()=>s("span",{class:"label"},"完成度:",-1)),$e={class:"value"},Oe={class:"attribute-item"},Re=p(()=>s("span",{class:"label"},"已完成项数:",-1)),Be={class:"value"},Pe={class:"attribute-item"},Ue=p(()=>s("span",{class:"label"},"创建者:",-1)),Ve={class:"value"},Me={class:"attribute-item"},Ae=p(()=>s("span",{class:"label"},"创建时间:",-1)),je={class:"value"},ze={class:"task-description"},Fe=p(()=>s("div",{class:"section-title"},"任务说明",-1)),Ge={class:"description-content"},Je={class:"action-buttons"},We={key:0,class:"task-items-section",style:{width:"100%"}},Xe={class:"task-stages"},qe=p(()=>s("h3",null,"任务项",-1)),He={key:1,class:"loading"},Ke={class:"dialog-footer"},Qe={__name:"detail",props:{taskDetail:{type:Object,default:null},loading:{type:Boolean,default:!1},taskList:{type:Array,default:()=>[]}},emits:["back","navigate","refresh"],setup(g,{emit:M}){const{proxy:i}=ue(),d=g,k=M,e=y(null);_e(()=>d.taskDetail,t=>{t?e.value=JSON.parse(JSON.stringify(t)):e.value=null},{immediate:!0,deep:!0});const m=y(!1),f=y(!1),b=y(!1),N=y(!1),A=t=>({待处理:"info",进行中:"primary",已完成:"success",已取消:"danger"})[t]||"info",T=t=>t?new Date(t).toLocaleDateString("zh-CN"):"无",D=()=>!e.value||!d.taskList||d.taskList.length===0?-1:d.taskList.findIndex(t=>t.taskId===e.value.task.taskId),j=U(()=>D()>0),z=U(()=>{const t=D();return t>=0&&t<d.taskList.length-1}),F=()=>{const t=D();if(t>0&&d.taskList.length>0){const a=d.taskList[t-1];k("navigate",a)}},G=()=>{const t=D();if(t>=0&&t<d.taskList.length-1){const a=d.taskList[t+1];k("navigate",a)}},J=()=>{e.value&&(f.value=!0)},W=async t=>{try{i.$message.success("任务启动成功"),f.value=!1,k("refresh")}catch(a){console.error("刷新数据失败:",a),i.$message.error("数据刷新失败")}},X=()=>{f.value=!1},q=async()=>{if(e.value&&e.value.task)try{await i.$confirm("确定要暂停该任务吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"});const t=await ne(e.value.task.taskId);t.code===200?(i.$message.success("任务已暂停"),e.value.task&&(e.value.task.status="进行中"),k("refresh")):i.$message.error(t.msg||"暂停失败")}catch(t){t!=="cancel"&&(console.error("暂停任务失败:",t),i.$message.error("暂停任务失败"))}},H=()=>{e.value&&e.value.task&&(m.value=!0)},K=async t=>{console.log("编辑任务关闭123");try{if(i.$message.success(t.isEdit?"任务更新成功":"任务创建成功"),m.value=!1,ke(()=>{}),t.isEdit&&t.data)try{const a=await ie(e.value.task.taskId);a.code===200&&(e.value=a.data)}catch(a){console.error("刷新任务详情失败:",a),e.value&&e.value.task&&(e.value.task.taskName=t.data.taskName||e.value.task.taskName,e.value.task.description=t.data.description||e.value.task.description,e.value.task.deadline=t.data.deadline||e.value.task.deadline,e.value.task.status=t.data.status||e.value.task.status)}k("refresh")}catch(a){console.error("刷新数据失败:",a),i.$message.error("数据刷新失败")}},Q=()=>{console.log("编辑任务关闭"),m.value=!1},Y=()=>{e.value&&e.value.task&&(b.value=!0)},Z=async()=>{if(e.value&&e.value.task)try{N.value=!0;const t=await oe(e.value.task.taskId);t.code===200?(i.$message.success("删除成功"),b.value=!1,k("refresh"),k("back")):i.$message.error(t.msg||"删除失败")}catch(t){console.error("删除任务失败:",t),i.$message.error("删除任务失败")}finally{N.value=!1}},ee=t=>({UNASSIGNED:"未开始",IN_PROGRESS:"进行中",COMPLETED_UNCONFIRMED:"已完成待确认",CONFIRMED:"已完成",PAUSED:"已暂停"})[t]||"未开始",te=t=>({UNASSIGNED:"info",IN_PROGRESS:"primary",CONFIRMED:"success",PAUSED:"warning",COMPLETED_UNCONFIRMED:"warning",CANCELLED:"danger"})[t]||"info";return(t,a)=>{var L,$,O,R,B;const u=_("el-button"),E=_("el-tag"),se=_("el-progress"),h=_("el-table-column"),ae=_("el-table"),w=_("el-skeleton-item"),x=_("el-skeleton"),le=_("el-dialog");return v(),I("div",me,[e.value?(v(),I("div",fe,[s("div",he,[s("span",null,"任务ID:"+c(e.value.task.taskId),1),s("div",ge,[l(u,{onClick:F,size:"small",disabled:!V(j)},{default:o(()=>[r(" 上一个 ")]),_:1},8,["disabled"]),l(u,{onClick:G,size:"small",disabled:!V(z)},{default:o(()=>[r(" 下一个 ")]),_:1},8,["disabled"])])]),s("div",be,[s("div",ye,[s("h2",null,c(e.value.task.taskName),1)]),s("div",Ce,[s("div",De,[s("div",Ie,[Se,s("span",Ne,[l(E,{type:A(e.value.task.status)},{default:o(()=>[r(c(e.value.task.status),1)]),_:1},8,["type"])])]),s("div",Te,[Ee,s("span",we,c(T(e.value.task.deadline)),1)]),s("div",xe,[Le,s("span",$e,[l(se,{percentage:e.value.task.completionRate,status:e.value.completionRate===100?"success":"","stroke-width":10},null,8,["percentage","status"])])]),s("div",Oe,[Re,s("span",Be,c(e.value.task.completedItems||0),1)]),s("div",Pe,[Ue,s("span",Ve,c(e.value.task.createBy||"未知"),1)]),s("div",Me,[Ae,s("span",je,c(T(e.value.task.createTime)||"未知"),1)])])]),s("div",ze,[Fe,s("div",Ge,c(e.value.task.description||"无"),1)]),s("div",Je,[l(u,{type:"danger",onClick:Y},{default:o(()=>[r("删除")]),_:1}),l(u,{type:"primary",onClick:H},{default:o(()=>[r("编辑")]),_:1}),e.value.statusCode===0||e.value.statusCode===3?(v(),S(u,{key:0,type:"success",onClick:J},{default:o(()=>[r(" 启动 ")]),_:1})):C("",!0),e.value.statusCode===1?(v(),S(u,{key:1,type:"warning",onClick:q},{default:o(()=>[r(" 暂停 ")]),_:1})):C("",!0)])]),e.value.statusCode!==0?(v(),I("div",We,[s("div",Xe,[qe,l(ae,{data:e.value.stagesWithItems,border:""},{default:o(()=>[l(h,{prop:"stageName",label:"流程",width:"150"}),l(h,{prop:"status",label:"状态",width:"100"},{default:o(n=>[l(E,{type:te(n.row.status)},{default:o(()=>[r(c(ee(n.row.status)),1)]),_:2},1032,["type"])]),_:1}),l(h,{prop:"assignToName",label:"负责人",width:"120"}),l(h,{prop:"startDate",label:"开始日期"}),l(h,{prop:"deadDate",label:"预计完成"}),l(h,{prop:"actualEndDate",label:"实际完成"})]),_:1},8,["data"])])])):C("",!0)])):(v(),I("div",He,[l(x,{animated:""},{template:o(()=>[l(w,{variant:"text",style:{width:"30%"}}),l(w,{variant:"h3",style:{width:"50%"}}),l(x,{style:{"margin-top":"20px"},rows:6})]),_:1})])),m.value?(v(),S(ce,{key:2,visible:m.value,"onUpdate:visible":a[0]||(a[0]=n=>m.value=n),"project-id":($=(L=e.value)==null?void 0:L.task)==null?void 0:$.projectId,"task-id":(R=(O=e.value)==null?void 0:O.task)==null?void 0:R.taskId,onSuccess:K,onClose:Q},null,8,["visible","project-id","task-id"])):C("",!0),f.value?(v(),S(re,{key:3,visible:f.value,"onUpdate:visible":a[1]||(a[1]=n=>f.value=n),task:(B=e.value)==null?void 0:B.task,onSuccess:W,onClose:X},null,8,["visible","task"])):C("",!0),l(le,{modelValue:b.value,"onUpdate:modelValue":a[3]||(a[3]=n=>b.value=n),title:"确认删除",width:"500px"},{footer:o(()=>[s("div",Ke,[l(u,{onClick:a[2]||(a[2]=n=>b.value=!1)},{default:o(()=>[r("取消")]),_:1}),l(u,{type:"danger",onClick:Z,loading:N.value},{default:o(()=>[r("确定")]),_:1},8,["loading"])])]),default:o(()=>{var n,P;return[s("span",null,'确定要删除任务 "'+c((P=(n=e.value)==null?void 0:n.task)==null?void 0:P.taskName)+'" 吗？',1)]}),_:1},8,["modelValue"])])}}},at=de(Qe,[["__scopeId","data-v-a9b4deeb"]]);export{at as default};
