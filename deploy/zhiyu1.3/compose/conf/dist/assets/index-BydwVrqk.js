import{_ as de,a as ve,r as l,B as R,w as me,G as pe,f as c,c as p,o as v,j as e,k as _e,l as j,P as L,h as n,i as d,t as i,N as ge,H as A,I as q,p as he,a1 as fe,y as ye,z as we}from"./index-CR6ovanu.js";import{I as be,g as F,a as G}from"./ItemDetailDialog-FOfzjPLO.js";import"./projectUser-CylPsKmU.js";import"./tasks-mvyL4cZG.js";import"./CreateTaskDialog-BiJjOoei.js";import"./StartTaskDialog-DQv5ARtA.js";const g=h=>(ye("data-v-1a445686"),h=h(),we(),h),Ie={class:"tasks-container"},De={class:"tasks-content"},Ce={class:"content-wrapper"},Ne={class:"sidebar"},Se={class:"sidebar-section"},ke=g(()=>e("h4",null,"待办",-1)),Te={class:"sidebar-section"},xe=g(()=>e("h4",null,"更多",-1)),ze={class:"sidebar-item"},Me=g(()=>e("span",null,"我完成的事项",-1)),Pe={class:"sidebar-item"},Re=g(()=>e("span",null,"我审核的事项",-1)),je={class:"main-content"},Be={class:"card-header"},Ee={class:"tasks-list"},Ue=g(()=>e("div",{class:"table-header"},[e("div",{class:"table-cell"},"#"),e("div",{class:"table-cell"},"类型"),e("div",{class:"table-cell"},"阶段"),e("div",{class:"table-cell"},"标题"),e("div",{class:"table-cell"},"状态"),e("div",{class:"table-cell"},"负责人"),e("div",{class:"table-cell"},"预计开始"),e("div",{class:"table-cell"},"预计完成"),e("div",{class:"table-cell"},"实际完成"),e("div",{class:"table-cell"},"所属项目")],-1)),Ve={class:"table-body"},$e={class:"table-cell"},Le={class:"table-cell"},Ae={class:"table-cell"},qe=["onClick"],Fe={class:"task-title-link"},Ge={class:"table-cell"},He={class:"table-cell"},Oe={class:"table-cell"},Qe={class:"table-cell"},Je={class:"table-cell"},Ke={class:"table-cell"},We={key:0,class:"empty-state"},Xe={key:1,class:"loading-state"},Ye={class:"pagination-wrapper"},Ze={__name:"index",setup(h){ve();const r=l("assigned"),u=l(!1),B=l(""),E=l(""),k=l(1),T=l(10),m=l(0),f=l([]),y=l([]),w=l([]),b=l([]),I=l(0),D=l(0),H=R(()=>r.value==="assigned"?"待完成事项":"待审核事项"),O=R(()=>{if(u.value)return"加载中...";switch(r.value){case"assigned":return"暂无待完成事项";case"review":return"暂无待审核事项";case"my-completed":return"暂无已完成事项";case"my-reviewed":return"暂无已审核事项";default:return"暂无数据"}}),U=R(()=>{switch(r.value){case"assigned":return f.value;case"review":return y.value;case"my-completed":return w.value;case"my-reviewed":return b.value;default:return[]}}),Q=t=>({0:"info",1:"primary",2:"warning",3:"danger",4:"success",5:"danger"})[t]||"info",J=t=>({0:"未分配",1:"待完成",2:"待审核",3:"已跳过",4:"已完成",5:"已驳回"})[t]||"未知状态",x=t=>{if(!t)return"-";try{if(typeof t=="string"){const s=new Date(t);return isNaN(s.getTime())?t:s.toLocaleDateString("zh-CN")}return t instanceof Date?t.toLocaleDateString("zh-CN"):t.toString()}catch{return t.toString()}},C=t=>{r.value=t},_=l(!1),z=l(null),V=l(""),K=t=>{console.log("查看任务项详情:",t),z.value=t.itemId,V.value=t.stageName,_.value=!0},W=()=>{_.value=!1,z.value=null},X=t=>{console.log("任务项操作成功:",t),P()},N=()=>{const t={pageNum:k.value,pageSize:T.value};return B.value&&(t.name=B.value),E.value&&(t.taskType=E.value),(r.value==="my-completed"||r.value==="my-reviewed")&&(t.type="all"),t},M=async()=>{var t;try{u.value=!0;const s=N(),o=await F(s);o.code===200?(f.value=o.rows||[],I.value=o.total||((t=o.rows)==null?void 0:t.length)||0,m.value=o.total||0):(f.value=[],I.value=0)}catch(s){console.error("获取待完成事项失败:",s),f.value=[],I.value=0}finally{u.value=!1}},$=async()=>{var t;try{const s=N(),o=await G(s);o.code===200?(y.value=o.rows||[],D.value=o.total||((t=o.rows)==null?void 0:t.length)||0,m.value=o.total||0):(y.value=[],D.value=0)}catch(s){console.error("获取待审核事项失败:",s),y.value=[],D.value=0}finally{u.value=!1}},Y=async()=>{try{u.value=!0;const t=N(),s=await F(t);s.code===200?(w.value=s.rows||[],m.value=s.total||0):w.value=[]}catch(t){console.error("获取我完成的事项失败:",t),w.value=[]}finally{u.value=!1}},Z=async()=>{try{u.value=!0;const t=N(),s=await G(t);s.code===200?(b.value=s.rows||[],m.value=s.total||0):b.value=[]}catch(t){console.error("获取我审核的事项失败:",t),b.value=[]}finally{u.value=!1}},ee=async()=>{await Promise.all([M(),$()])},P=async()=>{switch(r.value){case"assigned":await M();break;case"review":await $();break;case"my-completed":await Y();break;case"my-reviewed":await Z();break;default:await M()}};return me(r,()=>{P()}),pe(()=>{ee()}),(t,s)=>{const o=c("Document"),S=c("el-icon"),te=c("EditPen"),se=c("User"),ae=c("Edit"),le=c("el-tag"),ne=c("el-empty"),oe=c("el-skeleton-item"),ie=c("el-skeleton"),ce=c("el-card"),re=c("pagination");return v(),p("div",Ie,[e("div",De,[e("div",Ce,[e("div",Ne,[e("div",Se,[ke,e("ul",null,[e("li",{class:L(["sidebar-item",{active:r.value==="assigned"}])},[e("a",{href:"javascript:void(0)",onClick:s[0]||(s[0]=a=>C("assigned"))},[n(S,null,{default:d(()=>[n(o)]),_:1}),e("span",null,"待完成 · "+i(I.value),1)])],2),e("li",{class:L(["sidebar-item",{active:r.value==="review"}])},[e("a",{href:"javascript:void(0)",onClick:s[1]||(s[1]=a=>C("review"))},[n(S,null,{default:d(()=>[n(te)]),_:1}),e("span",null,"待审核 · "+i(D.value),1)])],2)])]),e("div",Te,[xe,e("ul",null,[e("li",ze,[e("a",{onClick:s[2]||(s[2]=a=>C("my-completed"))},[n(S,null,{default:d(()=>[n(se)]),_:1}),Me])]),e("li",Pe,[e("a",{onClick:s[3]||(s[3]=a=>C("my-reviewed"))},[n(S,null,{default:d(()=>[n(ae)]),_:1}),Re])])])])]),e("div",je,[n(ce,{class:"tasks-card",shadow:"hover"},{header:d(()=>[e("div",Be,[e("span",null,i(H.value),1)])]),default:d(()=>[e("div",Ee,[Ue,e("div",Ve,[(v(!0),p(A,null,q(U.value,(a,ue)=>(v(),p("div",{key:a.itemId||ue,class:"table-row"},[e("div",$e,[e("span",null,i(a.itemId),1)]),e("div",Le,[e("span",null,i(a.taskTypeLabel),1)]),e("div",Ae,[e("span",null,i(a.stageName||"开发"),1)]),e("div",{class:"table-cell task-title-cell",onClick:et=>K(a)},[e("span",Fe,i(a.itemName),1)],8,qe),e("div",Ge,[n(le,{type:Q(a.statusCode),size:"small"},{default:d(()=>[he(i(J(a.statusCode)),1)]),_:2},1032,["type"])]),e("div",He,[e("span",null,i(a.assignToName||"未分配"),1)]),e("div",Oe,[e("span",null,i(a.startDate?x(a.startDate):"-"),1)]),e("div",Qe,[e("span",null,i(a.deadDate?x(a.deadDate):"-"),1)]),e("div",Je,[e("span",null,i(a.completeTime?x(a.completeTime):"-"),1)]),e("div",Ke,[e("span",null,i(a.projectName||"未知项目"),1)])]))),128)),U.value.length===0&&!u.value?(v(),p("div",We,[n(ne,{description:O.value},null,8,["description"])])):j("",!0),u.value?(v(),p("div",Xe,[n(ie,{animated:""},{template:d(()=>[(v(),p(A,null,q(5,a=>n(oe,{variant:"p",style:{height:"40px","margin-bottom":"10px"},key:a})),64))]),_:1})])):j("",!0)])])]),_:1}),ge(e("div",Ye,[n(re,{total:m.value,page:k.value,"onUpdate:page":s[4]||(s[4]=a=>k.value=a),limit:T.value,"onUpdate:limit":s[5]||(s[5]=a=>T.value=a),onPagination:P},null,8,["total","page","limit"])],512),[[fe,m.value>0]])])])]),_.value?(v(),_e(be,{key:0,visible:_.value,"onUpdate:visible":s[6]||(s[6]=a=>_.value=a),"item-id":z.value,onSuccess:X,"stage-name":V.value,onClose:W},null,8,["visible","item-id","stage-name"])):j("",!0)])}}},it=de(Ze,[["__scopeId","data-v-1a445686"]]);export{it as default};
