import{D as g,_ as R,r as i,G as j,f as c,c as A,o as G,j as O,h as t,i as l,p as u,al as m,E as H}from"./index-CR6ovanu.js";function J(d){return g({url:"/task/stage/base/list",method:"get",params:d})}function K(d){return g({url:"/task/stage/base/add",method:"post",data:d})}function P(d){return g({url:"/task/stage/base/edit",method:"put",data:d})}function Q(d){return g({url:"/task/stage/base/delete/"+d,method:"delete"})}function W(d){return g({url:"/task/stage/base/batchOrder",method:"put",data:d})}const X={class:"base-stage-container"},Y={class:"action-buttons"},Z={class:"dialog-footer"},ee={class:"dialog-footer"},te={__name:"index",setup(d){const _=i([]),w=i(!1),v=i(!1),p=i(!1),y=i(""),b=i(!1),s=i([]),k=i(null),f=i({id:void 0,name:"",stageOrder:1}),B={name:[{required:!0,message:"请输入阶段名称",trigger:"blur"}],stageOrder:[{required:!0,message:"请输入排序",trigger:"blur"},{type:"number",min:1,max:9,message:"排序必须在1-9之间",trigger:"blur"}]},h=async()=>{w.value=!0;try{const a=await J();_.value=a.data}catch{m.error("获取公共阶段列表失败")}finally{w.value=!1}},S=()=>{y.value="新增公共阶段",b.value=!1,f.value={id:void 0,name:"",stageOrder:1},v.value=!0},$=a=>{y.value="编辑公共阶段",b.value=!0,f.value={...a},v.value=!0},E=a=>{H.confirm(`确认删除公共阶段"${a.name}"吗？`,"提示",{confirmButtonText:"确认",cancelButtonText:"取消",type:"warning"}).then(async()=>{try{await Q(a.id),m.success("删除成功"),h()}catch{m.error("删除失败")}}).catch(()=>{})},I=()=>{k.value.validate(async a=>{if(a)try{b.value?(await P(f.value),m.success("修改成功")):(await K(f.value),m.success("新增成功")),v.value=!1,h()}catch{m.error(b.value?"修改失败":"新增失败")}})},D=()=>{k.value.resetFields()},U=()=>{s.value=[..._.value].sort((a,e)=>a.stageOrder-e.stageOrder),p.value=!0},z=a=>{const e=s.value.findIndex(o=>o.id===a.id);if(e>0){const o=s.value[e-1].stageOrder;s.value[e-1].stageOrder=a.stageOrder,a.stageOrder=o;const r=s.value[e];s.value[e]=s.value[e-1],s.value[e-1]=r}},T=a=>{const e=s.value.findIndex(o=>o.id===a.id);if(e<s.value.length-1){const o=s.value[e+1].stageOrder;s.value[e+1].stageOrder=a.stageOrder,a.stageOrder=o;const r=s.value[e];s.value[e]=s.value[e+1],s.value[e+1]=r}},L=async()=>{try{const a={};s.value.forEach(e=>{a[e.id]=e.stageOrder}),await W({stageOrders:a}),m.success("批量调整排序成功"),p.value=!1,h()}catch{m.error("批量调整排序失败")}};return j(()=>{h()}),(a,e)=>{const o=c("el-button"),r=c("el-table-column"),C=c("el-table"),M=c("el-input"),N=c("el-form-item"),q=c("el-form"),V=c("el-dialog"),F=c("el-alert");return G(),A("div",X,[O("div",Y,[t(o,{type:"primary",onClick:S,class:"add-button"},{default:l(()=>[u("新增公共阶段")]),_:1}),t(o,{type:"success",onClick:U,disabled:_.value.length<2},{default:l(()=>[u(" 批量调整排序 ")]),_:1},8,["disabled"])]),t(C,{data:_.value,border:"",style:{width:"100%","margin-top":"20px"}},{default:l(()=>[t(r,{prop:"stageId",label:"ID",width:"80"}),t(r,{prop:"name",label:"阶段名称"}),t(r,{prop:"stageOrder",label:"排序",width:"80"}),t(r,{label:"操作",width:"200"},{default:l(n=>[t(o,{size:"small",onClick:x=>$(n.row)},{default:l(()=>[u("编辑")]),_:2},1032,["onClick"]),t(o,{size:"small",type:"danger",onClick:x=>E(n.row)},{default:l(()=>[u(" 删除 ")]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"]),t(V,{title:y.value,modelValue:v.value,"onUpdate:modelValue":e[2]||(e[2]=n=>v.value=n),width:"500px",onClose:D},{footer:l(()=>[O("span",Z,[t(o,{onClick:e[1]||(e[1]=n=>v.value=!1)},{default:l(()=>[u("取 消")]),_:1}),t(o,{type:"primary",onClick:I},{default:l(()=>[u("确 定")]),_:1})])]),default:l(()=>[t(q,{model:f.value,rules:B,ref_key:"formRef",ref:k,"label-width":"100px"},{default:l(()=>[t(N,{label:"阶段名称",prop:"name"},{default:l(()=>[t(M,{modelValue:f.value.name,"onUpdate:modelValue":e[0]||(e[0]=n=>f.value.name=n),placeholder:"请输入阶段名称"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["title","modelValue"]),t(V,{title:"批量调整排序",modelValue:p.value,"onUpdate:modelValue":e[4]||(e[4]=n=>p.value=n),width:"600px"},{footer:l(()=>[O("span",ee,[t(o,{onClick:e[3]||(e[3]=n=>p.value=!1)},{default:l(()=>[u("取 消")]),_:1}),t(o,{type:"primary",onClick:L},{default:l(()=>[u("保 存")]),_:1})])]),default:l(()=>[t(F,{title:"通过上下移动调整排序，排序序号将保持连续",type:"info","show-icon":"",style:{"margin-bottom":"20px"}}),t(C,{data:s.value,border:"",style:{width:"100%"},"row-key":"id"},{default:l(()=>[t(r,{prop:"name",label:"阶段名称"}),t(r,{prop:"stageOrder",label:"排序",width:"80"}),t(r,{label:"操作",width:"150"},{default:l(n=>[t(o,{size:"small",onClick:x=>z(n.row),disabled:n.$index===0},{default:l(()=>[u(" 上移 ")]),_:2},1032,["onClick","disabled"]),t(o,{size:"small",onClick:x=>T(n.row),disabled:n.$index===s.value.length-1},{default:l(()=>[u(" 下移 ")]),_:2},1032,["onClick","disabled"])]),_:1})]),_:1},8,["data"])]),_:1},8,["modelValue"])])}}},le=R(te,[["__scopeId","data-v-1c45ca4f"]]);export{le as default};
