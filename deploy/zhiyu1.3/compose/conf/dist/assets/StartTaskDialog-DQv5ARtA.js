import{_ as K,w as I,B as C,r as i,J as O,f as r,k as x,o as m,i as n,h as s,p as V,t as $,c as D,l as q,H as A,I as G,j as Q}from"./index-CR6ovanu.js";import{s as W}from"./tasks-mvyL4cZG.js";import{l as X}from"./projectUser-CylPsKmU.js";const Z={key:0,class:"pagination-wrapper"},ee={style:{display:"flex","justify-content":"center","align-items":"center",gap:"20px",width:"100%",padding:"20px 0"}},te={__name:"StartTaskDialog",props:{visible:{type:Boolean,default:!1},task:{type:Object,default:()=>(console.log("使用了默认的任务对象"),{})}},emits:["update:visible","success","close"],setup(N,{emit:Y}){const p=Y,d=N;I(()=>d.visible,e=>{console.log("StartTaskDialog - visible prop:",e)},{immediate:!0});const f=C({get:()=>d.visible,set:e=>{p("update:visible",e)}}),S=C(()=>{var e;return(e=d.task)!=null&&e.taskName?` # ${d.task.taskId} -启动`:"启动任务"}),g=i(null),v=i(!1),t=O({taskId:null,taskName:"",assignee:"",startTime:"",endTime:""}),B={assignee:[{required:!0,message:"请选择负责人",trigger:"change"}]},_=i([]),k=i(0),h=i(!1),u=i(1),F=i(10),b=i("");I(()=>d.task,e=>{console.log("start task中的参数",e),e&&(t.taskId=e.taskId||null,t.taskName=e.taskName||"",t.assignee="",t.startTime="",t.endTime="")},{immediate:!0});function y(e=1,l=""){h.value=!0,X(d.task.projectId).then(a=>{a.code===200&&(_.value=a.data,k.value=a.data.length)}).finally(()=>{h.value=!1})}function U(e){e&&y(u.value,b.value)}function j(e){u.value=e,y(e,b.value)}function M(e){b.value=e,u.value=1,y(1,e)}async function L(){var e;if(console.log("props.task:",d.task),console.log("Form data before validation:",t),!t.taskId){console.error("Task ID is missing");return}await((e=g.value)==null?void 0:e.validate(async l=>{if(l)try{v.value=!0;const a={taskId:t.taskId,assigneeId:t.assignee,startTime:t.startTime,plannedEndTime:t.endTime},c=await W(a);if(c.code===200)p("success",c);else throw console.error("Start task failed:",c),new Error(c.msg||"任务启动失败")}catch(a){throw console.error("启动任务失败:",a),a}finally{v.value=!1}}))}function z(){f.value=!1}function E(){var e;(e=g.value)==null||e.resetFields(),p("close")}return(e,l)=>{const a=r("el-form-item"),c=r("el-option"),P=r("el-pagination"),R=r("el-select"),T=r("el-date-picker"),H=r("el-form"),w=r("el-button"),J=r("el-dialog");return m(),x(J,{title:S.value,modelValue:f.value,"onUpdate:modelValue":l[3]||(l[3]=o=>f.value=o),width:"600px",onClose:E,"align-center":"","destroy-on-close":""},{footer:n(()=>[Q("div",ee,[s(w,{onClick:z},{default:n(()=>[V("取 消")]),_:1}),s(w,{type:"primary",onClick:L,loading:v.value},{default:n(()=>[V(" 确 定 ")]),_:1},8,["loading"])])]),default:n(()=>[s(H,{ref_key:"startFormRef",ref:g,model:t,rules:B,"label-width":"100px"},{default:n(()=>[s(a,{label:"任务名称",class:"form-item-spacing"},{default:n(()=>[V($(t.taskName),1)]),_:1}),s(a,{label:"负责人",prop:"assignee",class:"form-item-spacing"},{default:n(()=>[s(R,{modelValue:t.assignee,"onUpdate:modelValue":l[0]||(l[0]=o=>t.assignee=o),placeholder:"请选择负责人",style:{width:"100%"},remote:"","remote-method":M,loading:h.value,onVisibleChange:U,"popper-class":"custom-select-dropdown",filterable:""},{default:n(()=>[(m(!0),D(A,null,G(_.value,o=>(m(),x(c,{key:o.userId,label:o.nickName,value:o.userId},null,8,["label","value"]))),128)),k.value>_.value.length?(m(),D("div",Z,[s(P,{small:"",layout:"prev, pager, next",total:k.value,"page-size":F.value,"current-page":u.value,onCurrentChange:j},null,8,["total","page-size","current-page"])])):q("",!0)]),_:1},8,["modelValue","loading"])]),_:1}),s(a,{label:"开始时间",class:"form-item-spacing"},{default:n(()=>[s(T,{modelValue:t.startTime,"onUpdate:modelValue":l[1]||(l[1]=o=>t.startTime=o),type:"date",placeholder:"请选择开始时间","value-format":"YYYY-MM-DD",style:{width:"100%"}},null,8,["modelValue"])]),_:1}),s(a,{label:"预计完成",class:"form-item-spacing"},{default:n(()=>[s(T,{modelValue:t.endTime,"onUpdate:modelValue":l[2]||(l[2]=o=>t.endTime=o),type:"date",placeholder:"请选择结束时间","value-format":"YYYY-MM-DD",style:{width:"100%"}},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["title","modelValue"])}}},se=K(te,[["__scopeId","data-v-e0356c8b"]]);export{se as default};
