import{_ as Pe,F as je,J as M,r as I,e as Fe,w as be,L as ve,G as Ie,f as C,c as j,o as h,j as a,h as o,i as l,p as d,H as Z,I as A,k as z,l as ae,P as Ce,t as N,m as r,q as ie,K as G,y as $e,z as we}from"./index-CR6ovanu.js";import{l as Me,a as Ne,d as Ve,f as Ue,b as De,e as Re,c as xe,u as Ee}from"./mockup-_KlAqIPi.js";import{l as Se}from"./project-DyOYFxcD.js";const P=S=>($e("data-v-04787c48"),S=S(),we(),S),qe={class:"main"},ze={class:"header"},Be={class:"content"},He={class:"card-header"},Le={class:"button-group"},Te=["onClick"],Oe={key:0,class:"latest-tag"},Je={class:"version-actions"},Ze={key:0},Ae={class:"release-info"},Ge={class:"info-row"},Ke=P(()=>a("strong",null,"发布者:",-1)),Qe=P(()=>a("strong",null,"时间:",-1)),We=P(()=>a("strong",null,"版本:",-1)),Xe={class:"release-description"},Ye=P(()=>a("h4",{class:"release-title"},"发布说明",-1)),et={class:"related-files"},tt=P(()=>a("h4",{class:"release-title"},"相关文件",-1)),lt=P(()=>a("span",null,"在线原型：",-1)),ot=P(()=>a("span",null,"原型RP文件：",-1)),at={key:1},it=P(()=>a("span",null,"需求文档：",-1)),st={key:1},rt=P(()=>a("span",null,"效果图文件：",-1)),ct={key:1},dt={class:"dialog-footer"},nt={class:"dialog-footer"},pt={class:"upload-dialog"},ut=P(()=>a("div",{class:"upload-tip"},[a("span",{style:{color:"#67c23a"}},"支持扩展名：.zip "),a("br"),a("span",{style:{color:"#909399"}},"（单个文件建议不超过10MB）")],-1)),mt=P(()=>a("div",{class:"upload-tip"},[a("span",{style:{color:"#67c23a"}},"支持扩展名：.zip ,.rp "),a("br"),a("span",{style:{color:"#909399"}},"（单个文件建议不超过10MB）")],-1)),ft=P(()=>a("div",{class:"upload-tip"},[a("span",{style:{color:"#67c23a"}},"支持扩展名：.doc, .docx, .pdf "),a("br"),a("span",{style:{color:"#909399"}},"（单个文件建议不超过10MB）")],-1)),ht=P(()=>a("div",{class:"upload-tip"},[a("span",{style:{color:"#67c23a"}},"支持扩展名：.zip "),a("br"),a("span",{style:{color:"#909399"}},"（单个文件建议不超过10MB）")],-1)),_t={class:"dialog-footer"},gt={class:"dialog-footer"},kt=je({name:"prototype"}),yt=Object.assign(kt,{props:{projectId:{type:[String,Number],required:!0,default:null},mockupName:{type:String,default:null}},setup(S,{expose:se}){const K=M({pageNum:1,pageSize:10}),q=I([]),re=I(0),{proxy:m}=Fe(),_=S;be(()=>_.projectId,e=>{if(console.log("项目ID变化:",e),!(e==="0"||e===0)){if(e===""){console.log("knowLedge界面，项目ID是0 ，开始返回:");return}F()}});const Q=I({pageNum:1,pageSize:10,mockupName:void 0}),V=I([]),U=I(!1),D=I(!1),R=I(null),u=M({projectId:"",mockupName:""}),W=M({projectId:[{required:!0,message:"请选择所属项目",trigger:"change"}],mockupName:[{required:!0,message:"原型名称不能为空",trigger:"blur"},{min:1,max:50,message:"原型名称长度不能超过50个字符",trigger:"blur"}]}),ce=M({title:[{required:!0,message:"标题不能为空",trigger:"blur"},{max:50,message:"长度不能超过50个字符",trigger:"blur"}],htmlFile:[{validator:(e,t,i)=>{!t&&k.HtmlFilePath||t?i():i(new Error("HTML文件为必填项"))},trigger:"change"}]}),n=M({open:!1,title:"发布原型",isUploading:!1,data:{title:"",description:"",ProjectId:"",ProjectMockupId:""},headers:{Authorization:"Bearer "+ve()},htmlUrl:"/prod-api".replace(/\/?$/,"")+"/projectManager/projectfile/AddHtmlFileToProjectFile",fileUrl:"/prod-api".replace(/\/?$/,"")+"/projectManager/file/AddFile"}),x=I(!1),g=M({projectFileId:"",uploadDescription:"",title:""}),de={title:[{required:!0,message:"标题不能为空",trigger:"blur"},{max:50,message:"长度不能超过50个字符",trigger:"blur"}],uploadDescription:[{required:!0,message:"文件描述不能为空",trigger:"blur"}]},X=I(null);Ie(()=>{F(_.projectId)});function F(){let e=_.projectId;const t=String(e);console.log("加载数据:",e);let i={projectId:t,mockupName:_.mockupName,pageModel:Q.value};Me(i).then($=>{console.log("res",$),Q.totalCount=$.total,V.value=$.rows,V.value.length>0&&Promise.all(V.value.map(async y=>{try{const f=await Ne({projectMockupId:y.projectMockupId,pageModel:{pageIndex:1,pageSize:10,totalCount:0}});console.log(`获取文件列表(ID:${y.projectMockupId}):`,f),y.versions=f.rows.map((c,b)=>({version:`v${c.version}`,title:c.title,description:c.uploadDescription,time:c.updateTime||c.createTime,createBy:c.createBy,projectFileId:c.projectFileId,htmlFilePath:c.htmlFilePath,zipFilePath:c.zipFilePath,prototypeFilePath:c.prototypeFilePath,requirementsFilePath:c.requirementsFilePath,effectPictureFilePath:c.effectPictureFilePath,isExpanded:b===0&&O(c,f.rows)}))}catch(f){console.error(`获取文件列表失败(ID:${y.projectFileId}):`,f),y.versions=[]}})),console.log("完整数据:",V.value)})}function Y(e){e.isExpanded=!e.isExpanded}function ne(){Se(K).then(e=>{K.pageNum===1?q.value=e.rows:q.value=[...q.value,...e.rows],re.value=e.total}).finally(()=>{console.log("项目列表:",q.value)})}function ee(){console.log("添加原型"),ne(),u.projectId="",u.mockupName="",_.projectId&&(u.projectId=_.projectId),U.value=!0}async function te(){try{await R.value.validate();const e=await De({projectId:u.projectId,mockupName:u.mockupName});e.code===200?(m.$modal.msgSuccess("新增成功"),U.value=!1,F(_.projectId)):m.$modal.msgError("添加失败："+e.message)}catch(e){console.error("表单验证失败:",e)}}function pe(e){const t=V.value.find(i=>i.projectMockupId===e);if(!t){m.$modal.msgError("未找到原型数据");return}Object.assign(u,{projectMockupId:t.projectMockupId,projectId:t.projectId,mockupName:t.mockupName}),D.value=!0}async function le(){try{await R.value.validate();const e=await Re({projectMockupId:u.projectMockupId,projectId:u.projectId,mockupName:u.mockupName});e.code===200?(m.$modal.msgSuccess("修改成功"),D.value=!1,F(_.projectId)):m.$modal.msgError("修改失败："+e.message)}catch(e){console.error("表单验证失败:",e)}}async function ue(e){console.log("删除原型，项目文件ID:",e);try{await m.$modal.confirm("确定删除该原型？","警告",{type:"warning"})&&await Ue(e.toString())===!0&&(m.$modal.msgSuccess("删除成功"),F(_.projectId))}catch{console.log("取消删除")}}function me(e){console.log("添加新版本，项目文件ID:",e),n.data.projectMockupId=e,n.open=!0}const k=M({HtmlFilePath:"",ZipFilePath:"",PrototypeFilePath:"",RequirementsFilePath:"",EffectPictureFilePath:""});function B(e,t,i){if(e.code===200){switch(console.log("上传成功:",e),i){case"html":k.HtmlFilePath=e.data.htmlFilePath,k.ZipFilePath=e.data.zipFilePath;break;case"rp":k.PrototypeFilePath=e.data.fileUrl;break;case"requirement":k.RequirementsFilePath=e.data.fileUrl;break;case"image":k.EffectPictureFilePath=e.data.fileUrl;break}m.$modal.msgSuccess("上传成功")}else m.$modal.msgError("上传失败："+e.message);console.log("上传后的数据是:",k)}async function fe(){try{await R.value.validate();const e={Title:n.data.title,UploadDescription:n.data.description,ProjectId:_.projectId,ProjectMockupId:n.data.projectMockupId,ZipFilePath:k.ZipFilePath,HtmlFilePath:k.HtmlFilePath,PrototypeFilePath:k.PrototypeFilePath,RequirementsFilePath:k.RequirementsFilePath,EffectPictureFilePath:k.EffectPictureFilePath};console.log("最终提交的数据:",e);const t=await xe(e);t.code===200?(m.$modal.msgSuccess("提交成功"),n.open=!1,F(_.projectId)):m.$modal.msgError("提交失败："+t.message)}catch(e){console.error("表单验证失败:",e)}}function oe(){console.log("关闭对话框的回调"),Object.assign(n.data,{title:"",description:"",ProjectId:"",ProjectMockupId:""}),Object.assign(k,{HtmlFilePath:"",ZipFilePath:"",PrototypeFilePath:"",RequirementsFilePath:"",EffectPictureFilePath:""}),n.open=!1}function he(e){console.log("编辑版本信息:",JSON.stringify(e,null,2));const i="/prod-api".replace(/\/?$/,"")+e.htmlFilePath+"/start.html#&g=1";console.log("访问链接:",i),window.open(i,"_blank")}function _e(e,t){console.log("编辑版本信息:",JSON.stringify(t,null,2)),g.projectFileId=t.projectFileId,g.uploadDescription=t.description,g.title=t.title,x.value=!0}async function ge(){try{await X.value.validate();const e=await Ee({projectFileId:g.projectFileId,uploadDescription:g.uploadDescription,title:g.title});e.code===200?(m.$modal.msgSuccess("修改成功"),Object.assign(g,{projectFileId:"",uploadDescription:"",title:""}),x.value=!1,F(_.projectId)):m.$modal.msgError("修改失败："+e.message)}catch(e){console.error("表单验证失败:",e)}}function ke(){console.log("编辑对话框关闭的回调"),Object.assign(g,{projectFileId:"",uploadDescription:"",title:""})}function ye(e,t){console.log("删除详细信息:",JSON.stringify(t,null,2)),m.$modal.confirm("是否确认删除该版本？").then(function(){return Ve(t.projectFileId)}).then(()=>{F(_.projectId),m.$modal.msgSuccess("删除成功")}).catch(()=>{})}function H(e){let t="",i="文件";if(typeof e=="object"?e.htmlFilePath?(t=e.zipFilePath,i="原型HTML文件"):e.prototypeFilePath?(t=e.prototypeFilePath,i="原型RP文件"):e.requirementsFilePath?(t=e.requirementsFilePath,i="需求文档"):e.effectPictureFilePath&&(t=e.effectPictureFilePath,i="效果图文件"):t=e,!t){m.$modal.msgError("文件路径不存在");return}const y=`${"/prod-api".replace(/\/?$/,"")}${t}`,f=document.createElement("a");f.style.display="none",f.href=y;const E=`${(_.projectName||"项目").replace(/[\\/:*?"<>|]/g,"_")}_${i}`;f.setAttribute("download",E),document.body.appendChild(f),f.click(),document.body.removeChild(f)}function O(e,t){if(t.length===0)return!1;const $=t.map(y=>y.version).sort((y,f)=>f-y)[0];return e.version===$}return se({loadData:F,addPrototype:ee}),(e,t)=>{const i=C("el-button"),$=C("el-card"),y=C("el-option"),f=C("el-select"),c=C("el-form-item"),b=C("el-input"),E=C("el-form"),L=C("el-dialog"),T=C("el-upload");return h(),j("div",qe,[a("div",ze,[o(i,{class:"right-button",onClick:ee},{default:l(()=>[d("添加原型")]),_:1})]),a("div",Be,[(h(!0),j(Z,null,A(r(V),(s,v)=>(h(),z($,{key:v,class:"prototype-card"},{header:l(()=>[a("div",He,[a("span",null,N(s.mockupName),1),a("div",Le,[o(i,{onClick:p=>pe(s.projectMockupId)},{default:l(()=>[d("修改")]),_:2},1032,["onClick"]),o(i,{onClick:p=>ue(s.projectMockupId)},{default:l(()=>[d("删除")]),_:2},1032,["onClick"]),o(i,{onClick:p=>me(s.projectMockupId)},{default:l(()=>[d("上传新版本")]),_:2},1032,["onClick"])])])]),default:l(()=>[(h(!0),j(Z,null,A(s.versions,(p,J)=>(h(),j("div",{key:J,class:"version-item"},[a("div",{class:"version-header",onClick:w=>Y(p)},[a("span",{class:Ce(["version-number",{latest:O(p,s.versions)}])},[d(N(p.title)+" ",1),O(p,s.versions)?(h(),j("span",Oe,"latest")):ae("",!0)],2),a("div",Je,[o(i,{icon:"Edit",circle:"",onClick:w=>_e(J,p)},null,8,["onClick"]),o(i,{icon:"Delete",circle:"",type:"danger",onClick:w=>ye(J,p)},null,8,["onClick"]),o(i,{onClick:w=>Y(p)},{default:l(()=>[d(N(p.isExpanded?"收起":"展开"),1)]),_:2},1032,["onClick"])])],8,Te),p.isExpanded?(h(),j("div",Ze,[a("div",Ae,[a("div",Ge,[a("p",null,[Ke,d(" "+N(p.createBy),1)]),a("p",null,[Qe,d(" "+N(p.time),1)]),a("p",null,[We,d(" "+N(p.version),1)])])]),a("div",Xe,[Ye,a("pre",null,N(p.description),1)]),a("div",et,[tt,a("ul",null,[a("li",null,[lt,o(i,{onClick:w=>he(p)},{default:l(()=>[d("立即访问")]),_:2},1032,["onClick"]),o(i,{onClick:w=>H(p)},{default:l(()=>[d("下载")]),_:2},1032,["onClick"])]),a("li",null,[ot,p.prototypeFilePath?(h(),z(i,{key:0,onClick:w=>H(p.prototypeFilePath)},{default:l(()=>[d("下 载")]),_:2},1032,["onClick"])):(h(),j("span",at,"无"))]),a("li",null,[it,p.requirementsFilePath?(h(),z(i,{key:0,onClick:w=>H(p.requirementsFilePath)},{default:l(()=>[d("下 载")]),_:2},1032,["onClick"])):(h(),j("span",st,"无"))]),a("li",null,[rt,p.effectPictureFilePath?(h(),z(i,{key:0,onClick:w=>H(p.effectPictureFilePath)},{default:l(()=>[d("下 载")]),_:2},1032,["onClick"])):(h(),j("span",ct,"无"))])])])])):ae("",!0)]))),128))]),_:2},1024))),128))]),o(L,{modelValue:r(U),"onUpdate:modelValue":t[3]||(t[3]=s=>G(U)?U.value=s:null),title:"新增原型",width:"30%"},{footer:l(()=>[a("span",dt,[o(i,{onClick:t[2]||(t[2]=s=>U.value=!1)},{default:l(()=>[d("取消")]),_:1}),o(i,{type:"primary",onClick:te},{default:l(()=>[d("确定")]),_:1})])]),default:l(()=>[o(E,{model:r(u),rules:r(W),ref_key:"formRef",ref:R,"label-width":"80px","label-position":"top",onSubmit:ie(te,["prevent"])},{default:l(()=>[o(c,{label:"所属项目",prop:"projectId"},{default:l(()=>[o(f,{modelValue:r(u).projectId,"onUpdate:modelValue":t[0]||(t[0]=s=>r(u).projectId=s),placeholder:"请选择项目",style:{width:"100%"},filterable:""},{default:l(()=>[(h(!0),j(Z,null,A(r(q),s=>(h(),z(y,{key:s.projectId,label:s.projectName,value:s.projectId},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),o(c,{label:"原型名称",prop:"mockupName"},{default:l(()=>[o(b,{modelValue:r(u).mockupName,"onUpdate:modelValue":t[1]||(t[1]=s=>r(u).mockupName=s),placeholder:"请输入原型名称",style:{width:"100%"}},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue"]),o(L,{modelValue:r(D),"onUpdate:modelValue":t[6]||(t[6]=s=>G(D)?D.value=s:null),title:"编辑原型",width:"30%"},{footer:l(()=>[a("span",nt,[o(i,{onClick:t[5]||(t[5]=s=>D.value=!1)},{default:l(()=>[d("取消")]),_:1}),o(i,{type:"primary",onClick:le},{default:l(()=>[d("确定")]),_:1})])]),default:l(()=>[o(E,{model:r(u),rules:r(W),ref_key:"formRef",ref:R,"label-width":"80px","label-position":"top",onSubmit:ie(le,["prevent"])},{default:l(()=>[o(c,{label:"原型名称",prop:"mockupName"},{default:l(()=>[o(b,{modelValue:r(u).mockupName,"onUpdate:modelValue":t[4]||(t[4]=s=>r(u).mockupName=s),placeholder:"请输入原型名称",style:{width:"100%"}},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue"]),o(L,{title:r(n).title,modelValue:r(n).open,"onUpdate:modelValue":t[9]||(t[9]=s=>r(n).open=s),width:"900px","append-to-body":"","before-close":oe},{footer:l(()=>[a("div",_t,[o(i,{type:"primary",icon:"UploadFilled",onClick:fe},{default:l(()=>[d("提交上传")]),_:1}),o(i,{onClick:oe},{default:l(()=>[d("取消")]),_:1})])]),default:l(()=>[a("div",pt,[o(E,{ref_key:"formRef",ref:R,model:r(n).data,rules:r(ce),"label-width":"100px"},{default:l(()=>[o(c,{label:"标题",prop:"title"},{default:l(()=>[o(b,{modelValue:r(n).data.title,"onUpdate:modelValue":t[7]||(t[7]=s=>r(n).data.title=s),placeholder:"请输入标题",style:{width:"100%"}},null,8,["modelValue"])]),_:1}),o(c,{label:"发布说明",prop:"description"},{default:l(()=>[o(b,{modelValue:r(n).data.description,"onUpdate:modelValue":t[8]||(t[8]=s=>r(n).data.description=s),type:"textarea",rows:4,placeholder:"请输入发布说明",style:{width:"100%"}},null,8,["modelValue"])]),_:1}),o(c,{label:"HTML文件",prop:"htmlFile"},{default:l(()=>[o(T,{ref:"htmlUploadRef",limit:1,accept:".zip",headers:r(n).headers,action:r(n).htmlUrl,"on-success":(s,v)=>B(s,v,"html"),"auto-upload":!0,class:"custom-upload"},{tip:l(()=>[ut]),default:l(()=>[o(i,{type:"primary"},{default:l(()=>[d("选择文件")]),_:1})]),_:1},8,["headers","action","on-success"])]),_:1}),o(c,{label:"原型文件RP"},{default:l(()=>[o(T,{ref:"rpUploadRef",limit:1,accept:".zip,.rp",headers:r(n).headers,action:r(n).fileUrl,"on-success":(s,v)=>B(s,v,"rp"),"auto-upload":!0},{tip:l(()=>[mt]),default:l(()=>[o(i,null,{default:l(()=>[d("选择文件")]),_:1})]),_:1},8,["headers","action","on-success"])]),_:1}),o(c,{label:"需求文件"},{default:l(()=>[o(T,{ref:"requirementUploadRef",limit:1,accept:".doc,.docx,.pdf,.zip",headers:r(n).headers,action:r(n).fileUrl,"on-success":(s,v)=>B(s,v,"requirement"),"auto-upload":!0},{tip:l(()=>[ft]),default:l(()=>[o(i,null,{default:l(()=>[d("选择文件")]),_:1})]),_:1},8,["headers","action","on-success"])]),_:1}),o(c,{label:"效果图"},{default:l(()=>[o(T,{ref:"imageUploadRef",limit:1,accept:".zip",headers:r(n).headers,action:r(n).fileUrl,"on-success":(s,v)=>B(s,v,"image"),"auto-upload":!0},{tip:l(()=>[ht]),default:l(()=>[o(i,null,{default:l(()=>[d("选择文件")]),_:1})]),_:1},8,["headers","action","on-success"])]),_:1})]),_:1},8,["model","rules"])])]),_:1},8,["title","modelValue"]),o(L,{modelValue:r(x),"onUpdate:modelValue":t[13]||(t[13]=s=>G(x)?x.value=s:null),title:"编辑",width:"30%","before-close":ke},{footer:l(()=>[a("span",gt,[o(i,{onClick:t[12]||(t[12]=s=>x.value=!1)},{default:l(()=>[d("取消")]),_:1}),o(i,{type:"primary",onClick:ge},{default:l(()=>[d("确定")]),_:1})])]),default:l(()=>[o(E,{model:r(g),rules:de,ref_key:"editDescriptionFormRef",ref:X,"label-position":"top","label-width":"120px"},{default:l(()=>[o(c,{label:"标题",prop:"title"},{default:l(()=>[o(b,{modelValue:r(g).title,"onUpdate:modelValue":t[10]||(t[10]=s=>r(g).title=s),placeholder:"请输入标题",style:{width:"100%"}},null,8,["modelValue"])]),_:1}),o(c,{label:"发布说明",prop:"description"},{default:l(()=>[o(b,{modelValue:r(g).uploadDescription,"onUpdate:modelValue":t[11]||(t[11]=s=>r(g).uploadDescription=s),type:"textarea",rows:4,placeholder:"请输入发布说明",style:{width:"100%"}},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])])}}}),bt=Pe(yt,[["__scopeId","data-v-04787c48"]]);export{bt as default};
