import{c as R}from"./project-DyOYFxcD.js";import{l as T,e as $}from"./user-VS3yfzIo.js";import{_ as O,e as H,r as n,J,f as u,M as K,N as A,k as y,o as g,i as s,h as a,c as I,l as G,H as Q,I as W,p as x}from"./index-CR6ovanu.js";const X={key:0,class:"pagination-container"},Y={__name:"create",emits:["success","cancel"],setup(Z,{emit:w}){const{proxy:f}=H(),C=w,N=n(void 0),_=n(),i=n(!1),d=n([{userId:1,userName:"张三"},{userId:2,userName:"李四"},{userId:3,userName:"王五"}]),m=n(0),v=n(!1),j=n(1),V=n(10),h=n(""),l=J({projectName:"",projectCode:"",projectManager:null,deptId:null,startDate:"",endDate:"",remark:""});function p(t=1,e=""){v.value=!0;const c={pageNum:t,pageSize:V.value};e&&(c.nickName=e),T(c).then(o=>{if(!e&&(!o.rows||o.rows.length===0)){const b={userId:0,nickName:"本人"};d.value=[b],m.value=1}else d.value=o.rows,m.value=o.total}).finally(()=>{v.value=!1})}function D(t){h.value=t,j.value=1,p(1,t)}function M(t){t&&p(j.value,h.value)}function F(t){p(t,h.value)}p();function U(){$().then(t=>{!t.data||t.data.length===0?N.value=[{id:0,label:"本部门",children:[]}]:N.value=t.data})}U();const q={projectName:[{required:!0,message:"请输入项目名称",trigger:"blur"},{min:1,max:50,message:"项目名称长度要在1~50之间",trigger:"blur"}],projectCode:[{required:!0,message:"请输入项目编码",trigger:"blur"},{min:4,max:64,message:"项目编码长度要在4~64之间",trigger:"blur"}],projectManager:[{required:!0,message:"请选择项目经理",trigger:"change"}],deptId:[{required:!0,message:"请选择所属部门",trigger:"change"}],startDate:[{required:!0,message:"请选择开始日期",trigger:"change"}]},z=async()=>{_.value&&await _.value.validate(async t=>{if(t){i.value=!0;try{const e=await R(l);e.code===200?(f.$modal.msgSuccess("项目创建成功"),C("success")):f.$modal.msgError(e.msg||"创建失败")}catch(e){f.$modal.msgError("创建项目时发生错误"),console.error(e)}finally{i.value=!1}}})};(()=>{Object.assign(l,{projectName:"",projectCode:"",projectManager:null,deptId:null,startDate:"",endDate:"",remark:""})})();const L=()=>{C("cancel")};return(t,e)=>{const c=u("el-input"),o=u("el-form-item"),b=u("el-option"),P=u("el-pagination"),S=u("el-select"),k=u("el-button"),B=u("el-form"),E=K("loading");return A((g(),y(B,{ref_key:"projectFormRef",ref:_,model:l,rules:q,"label-width":"100px"},{default:s(()=>[a(o,{label:"项目名称",prop:"projectName"},{default:s(()=>[a(c,{modelValue:l.projectName,"onUpdate:modelValue":e[0]||(e[0]=r=>l.projectName=r),placeholder:"请输入项目名称"},null,8,["modelValue"])]),_:1}),a(o,{label:"项目编码",prop:"projectCode"},{default:s(()=>[a(c,{modelValue:l.projectCode,"onUpdate:modelValue":e[1]||(e[1]=r=>l.projectCode=r),placeholder:"请输入项目编码"},null,8,["modelValue"])]),_:1}),a(o,{label:"项目经理",prop:"projectManager"},{default:s(()=>[a(S,{modelValue:l.projectManager,"onUpdate:modelValue":e[2]||(e[2]=r=>l.projectManager=r),placeholder:"请选择项目经理",style:{width:"100%"},remote:"","remote-method":D,loading:v.value,onVisibleChange:M,filterable:""},{default:s(()=>[(g(!0),I(Q,null,W(d.value,r=>(g(),y(b,{key:r.userId,label:r.nickName,value:r.userId},null,8,["label","value"]))),128)),m.value>d.value.length?(g(),I("div",X,[a(P,{small:"",layout:"prev, pager, next",total:m.value,"page-size":V.value,"current-page":j.value,onCurrentChange:F},null,8,["total","page-size","current-page"])])):G("",!0)]),_:1},8,["modelValue","loading"])]),_:1}),a(o,{label:"项目描述",prop:"remark"},{default:s(()=>[a(c,{modelValue:l.remark,"onUpdate:modelValue":e[3]||(e[3]=r=>l.remark=r),type:"textarea",rows:4,placeholder:"请输入项目描述"},null,8,["modelValue"])]),_:1}),a(o,null,{default:s(()=>[a(k,{type:"primary",onClick:z,loading:i.value},{default:s(()=>[x(" 提交 ")]),_:1},8,["loading"]),a(k,{onClick:L},{default:s(()=>[x(" 取消 ")]),_:1})]),_:1})]),_:1},8,["model"])),[[E,i.value]])}}},re=O(Y,[["__scopeId","data-v-f391be6d"]]);export{re as default};
