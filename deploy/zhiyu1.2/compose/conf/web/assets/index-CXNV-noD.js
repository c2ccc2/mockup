import{K as Fe,_ as ze,C as Le,u as Te,e as Qe,r as s,D as de,L as Ee,G as Ae,Y as Ge,f as m,P as se,c as Ke,o as b,Q as f,h as e,R as $,i as a,m as ue,l as n,p as r,j as U,n as j,v as Oe,x as He}from"./index-B9EX3NfG.js";import{M as Ye,a as Je,d as We,u as Xe,b as Ze}from"./projectbase-DACQmqjX.js";import{d as el,G as pe,a as ll}from"./projectuser-CuT5vRBY.js";function al(C){return Fe({url:"/projectManager/filehistory/GetCustomPagedListAsync",method:"post",data:C})}const ce=C=>(Oe("data-v-9923a3c7"),C=C(),He(),C),tl={class:"app-container"},ol={slot:"footer",class:"dialog-footer"},nl={class:"app-container"},rl={class:"app-container"},il={class:"app-container"},dl=ce(()=>j("div",{class:"el-upload__text"},[r("将文件拖到此处，或"),j("em",null,"点击上传")],-1)),sl=ce(()=>j("div",{class:"el-upload__tip text-center"},[j("div",{class:"el-upload__tip"}),j("span",null,"仅允许导入zip格式文件。")],-1)),ul={class:"dialog-footer"},pl=Le({name:"ProjectBase"}),cl=Object.assign(pl,{setup(C){Te();const{proxy:d}=Qe(),L=s(!1),H=s(!1),T=s(!1),{project_states:ml}=d.useDict("project_states"),Y=s([]),x=s(!1),g=s(!0),Q=s(!0),E=s([]),J=s(!0),W=s(!0),I=s(0),X=s(0),Z=s(0),A=s(""),ee=s([]),le=s([]),ae=s([]),c=de({open:!1,title:"上传原型文件,zip格式",isUploading:!1,data:{UploadDescription:"",ProjectId:""},headers:{Authorization:"Bearer "+Ee()},url:"/projectManager/projectfile/Add"}),me=de({form:{projectId:0,projectName:"",projectDescription:"",projectState:10,createBy:"",createTime:"",updateBy:"",updateTime:""},queryParams:{pageModel:{PageIndex:1,PageSize:10},projectName:null},userqueryParams:{pageModel:{PageIndex:1,PageSize:10},projectId:0,selectType:"join",userName:""},unjoinuserqueryParams:{pageModel:{PageIndex:1,PageSize:10},projectId:0,selectType:"unjoin",userName:""},filequeryParams:{pageModel:{PageIndex:1,PageSize:10},projectId:0,UploadDescription:""},rules:{projectName:[{required:!0,message:"项目名称不能为空",trigger:"blur"}]}}),{queryParams:w,userqueryParams:v,unjoinuserqueryParams:_,filequeryParams:P,form:y,rules:fe}=Ae(me);function k(){g.value=!0,Ye(w.value).then(o=>{Y.value=o.rows,I.value=o.total,g.value=!1})}function te(){g.value=!0,pe(v.value).then(o=>{ee.value=o.rows,X.value=o.total,g.value=!1})}function oe(){g.value=!0,pe(_.value).then(o=>{le.value=o.rows,Z.value=o.total,g.value=!1})}function V(){g.value=!0,al(P.value).then(o=>{ae.value=o.rows,I.value=o.total,g.value=!1})}const ge=(o,l,p)=>{c.isUploading=!0},ve=(o,l,p)=>{c.open=!1,c.isUploading=!1,d.$refs.uploadRef.handleRemove(l),d.$alert("<div style='overflow: auto;overflow-x: hidden;max-height: 70vh;padding: 10px 20px 0;'>"+o.msg+"</div>","上传结果",{dangerouslyUseHTMLString:!0}),V()};function _e(){T.value=!0,M()}function ye(){x.value=!1,G()}function G(){y.value={projectId:0,projectName:"",projectDescription:"",projectState:10,createBy:"",createTime:"",updateBy:"",updateTime:""},d.resetForm("projectBaseRef")}async function K(){w.value.pageModel.PageIndex=1,k()}async function S(){te()}async function M(){_.value.pageModel.PageIndex=1,_.value.selectType="unjoin",oe()}function je(){d.resetForm("queryUserRef"),S()}function he(){d.resetForm("queryunjoinUserRef"),M()}function be(){d.resetForm("queryFileRef"),V()}function we(){d.resetForm("queryRef"),K()}function Pe(o){E.value=o.map(l=>l.projectId),J.value=o.length!==1,W.value=!o.length}function Ue(){G(),x.value=!0,A.value="添加项目"}function ne(o){G();const l=o.projectId||E.value;Je(l).then(p=>{y.value=p.data,x.value=!0,A.value="修改项目"})}function Ie(){d.$refs.projectBaseRef.validate(o=>{o&&(y.value.projectId!=null&&y.value.projectId>0?Xe(y.value).then(l=>{d.$modal.msgSuccess("修改成功"),x.value=!1,k()}):Ze(y.value).then(l=>{d.$modal.msgSuccess("新增成功"),x.value=!1,k()}))})}function re(o){const l=o.projectId||E.value;d.$modal.confirm('是否确认删除编号为"'+l+'"的数据项？').then(function(){return We(l)}).then(()=>{k(),d.$modal.msgSuccess("删除成功")}).catch(()=>{})}function xe(o){v.value.projectId=o.projectId,_.value.projectId=o.projectId,L.value=!0,S()}function ie(){P.value.pageModel.PageIndex=1,V()}function ke(o){d.$modal.confirm("是否确认用户加入到项目？").then(function(){const l={projectId:v.value.projectId,userId:o.userId};ll(l).then(()=>{d.$modal.msgSuccess("添加成功"),S(),M()}).catch(p=>{d.$modal.msgError("添加失败："+p.message)})}).catch(()=>{})}function Ce(o){d.$modal.confirm("是否确认把用户从项目移除？").then(function(){const l={projectId:v.value.projectId,userIds:[o.userId]};el(l).then(()=>{d.$modal.msgSuccess("移除成功"),S(),M()}).catch(p=>{d.$modal.msgError("移除失败："+p.message)})}).catch(()=>{})}function Ve(){d.$refs.uploadRef.submit(),V()}function Se(){c.open=!0}function Me(o){window.open("/"+o.filePath,"_blank")}const Ne=()=>{console.log("执行清理操作")};return Ge(()=>{Ne(),console.log("组件实例已销毁")}),k(),(o,l)=>{const p=m("el-input"),h=m("el-form-item"),i=m("el-button"),N=m("el-form"),O=m("el-col"),Be=m("right-toolbar"),Re=m("el-row"),u=m("el-table-column"),q=m("el-table"),F=m("pagination"),B=m("el-dialog"),De=m("upload-filled"),$e=m("el-icon"),qe=m("el-upload"),R=se("hasPermi"),z=se("loading");return b(),Ke("div",tl,[f(e(N,{model:n(w),ref:"queryRef",inline:!0,"label-width":"68px"},{default:a(()=>[e(h,{label:"项目名称",prop:"projectName"},{default:a(()=>[e(p,{modelValue:n(w).projectName,"onUpdate:modelValue":l[0]||(l[0]=t=>n(w).projectName=t),placeholder:"请输入项目名称",clearable:"",onKeyup:ue(K,["enter"])},null,8,["modelValue"])]),_:1}),e(h,null,{default:a(()=>[e(i,{type:"primary",icon:"Search",onClick:K},{default:a(()=>[r("搜索")]),_:1}),e(i,{icon:"Refresh",onClick:we},{default:a(()=>[r("重置")]),_:1})]),_:1})]),_:1},8,["model"]),[[$,Q.value]]),e(Re,{gutter:10,class:"mb8"},{default:a(()=>[e(O,{span:1.5},{default:a(()=>[f((b(),U(i,{type:"primary",plain:"",icon:"Plus",onClick:Ue},{default:a(()=>[r("新增")]),_:1})),[[R,["projectManager:projectBase:add"]]])]),_:1}),e(O,{span:1.5},{default:a(()=>[f((b(),U(i,{type:"success",plain:"",icon:"Edit",disabled:J.value,onClick:ne},{default:a(()=>[r("修改")]),_:1},8,["disabled"])),[[R,["projectManager:projectBase:edit"]]])]),_:1}),e(O,{span:1.5},{default:a(()=>[f((b(),U(i,{type:"danger",plain:"",icon:"Delete",disabled:W.value,onClick:re},{default:a(()=>[r("删除")]),_:1},8,["disabled"])),[[R,["projectManager:projectBase:remove"]]])]),_:1}),e(Be,{showSearch:Q.value,"onUpdate:showSearch":l[1]||(l[1]=t=>Q.value=t),onQueryTable:k},null,8,["showSearch"])]),_:1}),f((b(),U(q,{data:Y.value,onSelectionChange:Pe},{default:a(()=>[e(u,{type:"selection",width:"55",align:"center"}),e(u,{label:"项目ID",align:"center",prop:"projectId",width:"110"}),e(u,{label:"项目名称",prop:"projectName"}),e(u,{label:"操作",align:"center","class-name":"small-padding fixed-width"},{default:a(t=>[e(i,{link:"",type:"primary",icon:"User",onClick:D=>xe(t.row)},{default:a(()=>[r("项目用户")]),_:2},1032,["onClick"]),f((b(),U(i,{link:"",type:"primary",icon:"Edit",onClick:D=>ne(t.row)},{default:a(()=>[r("修改")]),_:2},1032,["onClick"])),[[R,["projectManager:projectBase:edit"]]]),f((b(),U(i,{link:"",type:"primary",icon:"Delete",onClick:D=>re(t.row)},{default:a(()=>[r("删除")]),_:2},1032,["onClick"])),[[R,["projectManager:projectBase:remove"]]])]),_:1})]),_:1},8,["data"])),[[z,g.value]]),f(e(F,{total:I.value,page:n(w).pageModel.PageIndex,"onUpdate:page":l[2]||(l[2]=t=>n(w).pageModel.PageIndex=t),limit:n(w).pageModel.PageSize,"onUpdate:limit":l[3]||(l[3]=t=>n(w).pageModel.PageSize=t),onPagination:k},null,8,["total","page","limit"]),[[$,I.value>0]]),e(B,{title:A.value,modelValue:x.value,"onUpdate:modelValue":l[6]||(l[6]=t=>x.value=t),width:"500px","append-to-body":""},{default:a(()=>[e(N,{ref:"projectBaseRef",model:n(y),rules:n(fe),"label-width":"80px"},{default:a(()=>[e(h,{label:"项目名称",prop:"projectName"},{default:a(()=>[e(p,{modelValue:n(y).projectName,"onUpdate:modelValue":l[4]||(l[4]=t=>n(y).projectName=t),placeholder:"请输入项目名称"},null,8,["modelValue"])]),_:1}),e(h,{label:"项目描述",prop:"projectDescription"},{default:a(()=>[e(p,{modelValue:n(y).projectDescription,"onUpdate:modelValue":l[5]||(l[5]=t=>n(y).projectDescription=t),placeholder:"请输入项目描述"},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"]),j("div",ol,[e(i,{type:"primary",onClick:Ie},{default:a(()=>[r("确 定")]),_:1}),e(i,{onClick:ye},{default:a(()=>[r("取 消")]),_:1})])]),_:1},8,["title","modelValue"]),e(B,{modelValue:L.value,"onUpdate:modelValue":l[10]||(l[10]=t=>L.value=t),title:"已加入项目用户",width:"800px","append-to-body":""},{default:a(()=>[j("div",nl,[e(N,{model:n(v),ref:"queryUserRef",inline:!0},{default:a(()=>[e(h,{label:"用户名称",prop:"userName"},{default:a(()=>[e(p,{modelValue:n(v).userName,"onUpdate:modelValue":l[7]||(l[7]=t=>n(v).userName=t),placeholder:"请输入用户名称",clearable:"",style:{width:"240px"}},null,8,["modelValue"])]),_:1}),e(h,null,{default:a(()=>[e(i,{type:"primary",icon:"Search",onClick:S},{default:a(()=>[r("搜索")]),_:1}),e(i,{icon:"Refresh",onClick:je},{default:a(()=>[r("重置")]),_:1}),e(i,{type:"primary",icon:"Plus",onClick:_e},{default:a(()=>[r("添加用户")]),_:1})]),_:1})]),_:1},8,["model"]),f((b(),U(q,{data:ee.value},{default:a(()=>[e(u,{label:"用户名称",prop:"userName","show-overflow-tooltip":!0}),e(u,{label:"用户昵称",prop:"nickName","show-overflow-tooltip":!0}),e(u,{label:"手机",prop:"phonenumber","show-overflow-tooltip":!0}),e(u,{label:"操作",align:"center","class-name":"small-padding fixed-width"},{default:a(t=>[e(i,{link:"",type:"primary",icon:"Remove",onClick:D=>Ce(t.row)},{default:a(()=>[r("移除")]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])),[[z,g.value]]),f(e(F,{total:I.value,page:n(v).pageModel.PageIndex,"onUpdate:page":l[8]||(l[8]=t=>n(v).pageModel.PageIndex=t),limit:n(v).pageModel.pageSize,"onUpdate:limit":l[9]||(l[9]=t=>n(v).pageModel.pageSize=t),onPagination:te},null,8,["total","page","limit"]),[[$,X.value>0]])])]),_:1},8,["modelValue"]),e(B,{modelValue:T.value,"onUpdate:modelValue":l[14]||(l[14]=t=>T.value=t),title:"待加入项目用户",width:"800px","append-to-body":""},{default:a(()=>[j("div",rl,[e(N,{model:n(_),ref:"queryunjoinUserRef",inline:!0},{default:a(()=>[e(h,{label:"用户名称",prop:"userName"},{default:a(()=>[e(p,{modelValue:n(_).userName,"onUpdate:modelValue":l[11]||(l[11]=t=>n(_).userName=t),placeholder:"请输入用户名称",clearable:"",style:{width:"240px"}},null,8,["modelValue"])]),_:1}),e(h,null,{default:a(()=>[e(i,{type:"primary",icon:"Search",onClick:M},{default:a(()=>[r("搜索")]),_:1}),e(i,{icon:"Refresh",onClick:he},{default:a(()=>[r("重置")]),_:1})]),_:1})]),_:1},8,["model"]),f((b(),U(q,{data:le.value},{default:a(()=>[e(u,{label:"用户名称",prop:"userName","show-overflow-tooltip":!0}),e(u,{label:"用户昵称",prop:"nickName","show-overflow-tooltip":!0}),e(u,{label:"手机",prop:"phonenumber","show-overflow-tooltip":!0}),e(u,{label:"操作",align:"center","class-name":"small-padding fixed-width"},{default:a(t=>[e(i,{link:"",type:"primary",icon:"CircleClose",onClick:D=>ke(t.row)},{default:a(()=>[r("加入")]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])),[[z,g.value]]),f(e(F,{total:I.value,page:n(_).pageModel.PageIndex,"onUpdate:page":l[12]||(l[12]=t=>n(_).pageModel.PageIndex=t),limit:n(_).pageModel.pageSize,"onUpdate:limit":l[13]||(l[13]=t=>n(_).pageModel.pageSize=t),onPagination:oe},null,8,["total","page","limit"]),[[$,Z.value>0]])])]),_:1},8,["modelValue"]),e(B,{modelValue:H.value,"onUpdate:modelValue":l[18]||(l[18]=t=>H.value=t),title:"项目原型管理",width:"800px","append-to-body":""},{default:a(()=>[j("div",il,[e(N,{model:n(P),ref:"queryFileRef",inline:!0},{default:a(()=>[e(h,{label:"描述",prop:"UploadDescription"},{default:a(()=>[e(p,{modelValue:n(P).UploadDescription,"onUpdate:modelValue":l[15]||(l[15]=t=>n(P).UploadDescription=t),placeholder:"请输入关键字",clearable:"",style:{width:"240px"},onKeyup:ue(ie,["enter"])},null,8,["modelValue"])]),_:1}),e(h,null,{default:a(()=>[e(i,{type:"primary",icon:"Search",onClick:ie},{default:a(()=>[r("搜索")]),_:1}),e(i,{icon:"Refresh",onClick:be},{default:a(()=>[r("重置")]),_:1}),e(i,{icon:"primary",onClick:Se},{default:a(()=>[r("添加")]),_:1})]),_:1})]),_:1},8,["model"]),f((b(),U(q,{data:ae.value},{default:a(()=>[e(u,{type:"selection",width:"55",align:"center"}),r(" --> "),e(u,{label:"创建日期",prop:"createTime","show-overflow-tooltip":!0}),e(u,{label:"描述",prop:"uploadDescription","show-overflow-tooltip":!0}),e(u,{label:"操作",align:"center","class-name":"small-padding fixed-width"},{default:a(t=>[e(i,{link:"",type:"primary",icon:"CircleClose",onClick:D=>Me(t.row)},{default:a(()=>[r("下载")]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])),[[z,g.value]]),f(e(F,{total:I.value,page:n(P).pageModel.PageIndex,"onUpdate:page":l[16]||(l[16]=t=>n(P).pageModel.PageIndex=t),limit:n(P).pageModel.PageSize,"onUpdate:limit":l[17]||(l[17]=t=>n(P).pageModel.PageSize=t),onPagination:V},null,8,["total","page","limit"]),[[$,I.value>0]])])]),_:1},8,["modelValue"]),e(B,{title:c.title,modelValue:c.open,"onUpdate:modelValue":l[21]||(l[21]=t=>c.open=t),width:"400px","append-to-body":""},{footer:a(()=>[j("div",ul,[e(i,{type:"primary",onClick:Ve},{default:a(()=>[r("确 定")]),_:1}),e(i,{onClick:l[20]||(l[20]=t=>c.open=!1)},{default:a(()=>[r("取 消")]),_:1})])]),default:a(()=>[e(qe,{ref:"uploadRef",limit:1,accept:"zip,rar",data:c.data,headers:c.headers,action:c.url,disabled:c.isUploading,"on-progress":ge,"on-success":ve,"auto-upload":!1,drag:""},{tip:a(()=>[sl]),default:a(()=>[e($e,{class:"el-icon--upload"},{default:a(()=>[e(De)]),_:1}),dl]),_:1},8,["data","headers","action","disabled"]),j("div",null,[e(p,{modelValue:c.data.UploadDescription,"onUpdate:modelValue":l[19]||(l[19]=t=>c.data.UploadDescription=t),type:"textarea",placeholder:"请输入描述"},null,8,["modelValue"])])]),_:1},8,["title","modelValue"])])}}}),_l=ze(cl,[["__scopeId","data-v-9923a3c7"]]);export{_l as default};
