import{K as w,_ as me,C as fe,e as he,w as _e,r as $,D as q,L as ge,M as ke,f as V,c as b,n as l,h as a,i as o,p as r,H as W,I as X,l as n,q as Y,F as O,v as ye,x as Pe,o as y,j as H,k as ee,N as Fe,B as R}from"./index-S0LnM6pn.js";function je(p){return w({url:"/projectManager/mockup/Add",method:"post",data:p})}function be(p){return w({url:"/projectManager/mockup/list",method:"post",data:p})}function ve(p){return w({url:"/projectManager/mockup/UpdateName",method:"put",data:p})}function Ce(p){return w({url:"/projectManager/mockup/Remove/"+p,method:"delete"})}function Ie(p){return w({url:"/projectmanager/projectfile/list",method:"post",data:p})}function we(p){return w({url:"/projectmanager/projectfile/AddProjectFile",method:"post",data:p})}function Me(p){return w({url:"/projectmanager/projectfile/updatename",method:"put",data:p})}function $e(p){return w({url:"/projectmanager/projectfile/Remove/"+p,method:"delete"})}const _=p=>(ye("data-v-4b445b16"),p=p(),Pe(),p),Ve={class:"main"},Re={class:"header"},Ue=_(()=>l("span",{class:"title"},"原型管理",-1)),De={class:"content"},Ee={class:"card-header"},Ne={class:"button-group"},xe=["onClick"],Se={key:0,class:"latest-tag"},qe={class:"version-actions"},ze={key:0},Be={class:"release-info"},He={class:"info-row"},Te=_(()=>l("strong",null,"发布者:",-1)),Le=_(()=>l("strong",null,"时间:",-1)),Oe=_(()=>l("strong",null,"版本:",-1)),Ae={class:"release-description"},Ze=_(()=>l("h4",{class:"release-title"},"发布说明",-1)),Je={class:"related-files"},Ke=_(()=>l("h4",{class:"release-title"},"相关文件",-1)),Ge=_(()=>l("span",null,"在线原型：",-1)),Qe=_(()=>l("span",null,"原型RP文件：",-1)),We={key:1},Xe=_(()=>l("span",null,"需求文档：",-1)),Ye={key:1},et=_(()=>l("span",null,"效果图文件：",-1)),tt={key:1},ot={class:"dialog-footer"},lt={class:"dialog-footer"},at={class:"upload-dialog"},it=_(()=>l("div",{class:"upload-tip"},[l("span",{style:{color:"#67c23a"}},"支持扩展名：.zip "),l("br"),l("span",{style:{color:"#909399"}},"（单个文件建议不超过10MB）")],-1)),st=_(()=>l("div",{class:"upload-tip"},[l("span",{style:{color:"#67c23a"}},"支持扩展名：.zip ,.rp "),l("br"),l("span",{style:{color:"#909399"}},"（单个文件建议不超过10MB）")],-1)),nt=_(()=>l("div",{class:"upload-tip"},[l("span",{style:{color:"#67c23a"}},"支持扩展名：.doc, .docx, .pdf "),l("br"),l("span",{style:{color:"#909399"}},"（单个文件建议不超过10MB）")],-1)),rt=_(()=>l("div",{class:"upload-tip"},[l("span",{style:{color:"#67c23a"}},"支持扩展名：.zip "),l("br"),l("span",{style:{color:"#909399"}},"（单个文件建议不超过10MB）")],-1)),ct={class:"dialog-footer"},dt={class:"dialog-footer"},ut=fe({name:"prototype"}),pt=Object.assign(ut,{props:{projectId:{type:[String,Number],required:!0},projectName:{type:String,default:"项目"}},setup(p){const{proxy:h}=he(),P=p;_e(()=>P.projectId,e=>{if(console.log("项目ID变化:",e),!(e==="0"||e===0)){if(e===""){console.log("knowLedge界面，项目ID是0 ，开始返回:");return}v(e)}});const A=$({pageIndex:1,pageSize:10}),U=$([]),D=$(!1),E=$(!1),N=$(null),F=q({title:""}),te=q({title:[{required:!0,message:"标题不能为空",trigger:"blur"},{max:50,message:"长度不能超过50个字符",trigger:"blur"}],htmlFile:[{validator:(e,t,i)=>{!t&&k.HtmlFilePath||t?i():i(new Error("HTML文件为必填项"))},trigger:"change"}]}),d=q({open:!1,title:"发布原型",isUploading:!1,data:{title:"",description:"",ProjectId:"",ProjectMockupId:""},headers:{Authorization:"Bearer "+ge()},htmlUrl:window.location.origin+"/projectManager/projectfile/AddHtmlFileToProjectFile",fileUrl:window.location.origin+"/projectManager/file/AddFile"}),x=$(!1),g=q({projectFileId:"",uploadDescription:"",title:""}),oe={title:[{required:!0,message:"标题不能为空",trigger:"blur"},{max:50,message:"长度不能超过50个字符",trigger:"blur"}],uploadDescription:[{required:!0,message:"文件描述不能为空",trigger:"blur"}]},Z=$(null);ke(()=>{v(P.projectId)});function v(e){if(!e)return;const t=String(e);console.log("加载数据:",e);let i={projectId:t,pageModel:A.value};be(i).then(C=>{console.log("res",C),A.totalCount=C.total,U.value=C.rows,U.value.length>0&&Promise.all(U.value.map(async f=>{try{const c=await Ie({projectMockupId:f.projectMockupId,pageModel:{pageIndex:1,pageSize:10,totalCount:0}});console.log(`获取文件列表(ID:${f.projectMockupId}):`,c),f.versions=c.rows.map((m,M)=>({version:`v${m.version}`,title:m.title,description:m.uploadDescription,time:m.updateTime||m.createTime,createBy:m.createBy,projectFileId:m.projectFileId,htmlFilePath:m.htmlFilePath,zipFilePath:m.zipFilePath,prototypeFilePath:m.prototypeFilePath,requirementsFilePath:m.requirementsFilePath,effectPictureFilePath:m.effectPictureFilePath,isExpanded:M===0&&T(m,c.rows)}))}catch(c){console.error(`获取文件列表失败(ID:${f.projectFileId}):`,c),f.versions=[]}})),console.log("完整数据:",U.value)})}function J(e){e.isExpanded=!e.isExpanded}function le(){console.log("添加原型"),F.mockupName="",D.value=!0}async function K(){try{await N.value.validate();const e=await je({projectId:P.projectId,...F});e.code===200?(h.$modal.msgSuccess("新增成功"),D.value=!1,v(P.projectId)):h.$modal.msgError("添加失败："+e.message)}catch(e){console.error("表单验证失败:",e)}}function ae(e){const t=U.value.find(i=>i.projectMockupId===e);if(!t){h.$modal.msgError("未找到原型数据");return}Object.assign(F,{projectMockupId:t.projectMockupId,mockupName:t.mockupName}),E.value=!0}async function G(){try{await N.value.validate();const e=await ve({projectId:P.projectId,...F});e.code===200?(h.$modal.msgSuccess("修改成功"),E.value=!1,v(P.projectId)):h.$modal.msgError("修改失败："+e.message)}catch(e){console.error("表单验证失败:",e)}}async function ie(e){console.log("删除原型，项目文件ID:",e);try{await h.$modal.confirm("确定删除该原型？","警告",{type:"warning"})&&await Ce(e.toString())===!0&&(h.$modal.msgSuccess("删除成功"),v(P.projectId))}catch{console.log("取消删除")}}function se(e){console.log("添加新版本，项目文件ID:",e),d.data.projectMockupId=e,d.open=!0}const k=q({HtmlFilePath:"",ZipFilePath:"",PrototypeFilePath:"",RequirementsFilePath:"",EffectPictureFilePath:""});function z(e,t,i){if(e.code===200){switch(console.log("上传成功:",e),i){case"html":k.HtmlFilePath=e.data.htmlFilePath,k.ZipFilePath=e.data.zipFilePath;break;case"rp":k.PrototypeFilePath=e.data.fileUrl;break;case"requirement":k.RequirementsFilePath=e.data.fileUrl;break;case"image":k.EffectPictureFilePath=e.data.fileUrl;break}h.$modal.msgSuccess("上传成功")}else h.$modal.msgError("上传失败："+e.message);console.log("上传后的数据是:",k)}async function ne(){try{await N.value.validate();const e={Title:d.data.title,UploadDescription:d.data.description,ProjectId:P.projectId,ProjectMockupId:d.data.projectMockupId,ZipFilePath:k.ZipFilePath,HtmlFilePath:k.HtmlFilePath,PrototypeFilePath:k.PrototypeFilePath,RequirementsFilePath:k.RequirementsFilePath,EffectPictureFilePath:k.EffectPictureFilePath};console.log("最终提交的数据:",e);const t=await we(e);t.code===200?(h.$modal.msgSuccess("提交成功"),d.open=!1,v(P.projectId)):h.$modal.msgError("提交失败："+t.message)}catch(e){console.error("表单验证失败:",e)}}function Q(){console.log("关闭对话框的回调"),Object.assign(d.data,{title:"",description:"",ProjectId:"",ProjectMockupId:""}),Object.assign(k,{HtmlFilePath:"",ZipFilePath:"",PrototypeFilePath:"",RequirementsFilePath:"",EffectPictureFilePath:""}),d.open=!1}function re(e){console.log("编辑版本信息:",JSON.stringify(e,null,2));const i="/".replace(/\/?$/,"")+e.htmlFilePath+"/start.html#&g=1";console.log("访问链接:",i),window.open(i,"_blank")}function ce(e,t){console.log("编辑版本信息:",JSON.stringify(t,null,2)),g.projectFileId=t.projectFileId,g.uploadDescription=t.description,g.title=t.title,x.value=!0}async function de(){try{await Z.value.validate();const e=await Me({projectFileId:g.projectFileId,uploadDescription:g.uploadDescription,title:g.title});e.code===200?(h.$modal.msgSuccess("修改成功"),Object.assign(g,{projectFileId:"",uploadDescription:"",title:""}),x.value=!1,v(P.projectId)):h.$modal.msgError("修改失败："+e.message)}catch(e){console.error("表单验证失败:",e)}}function ue(){console.log("编辑对话框关闭的回调"),Object.assign(g,{projectFileId:"",uploadDescription:"",title:""})}function pe(e,t){console.log("删除详细信息:",JSON.stringify(t,null,2)),h.$modal.confirm("是否确认删除该版本？").then(function(){return $e(t.projectFileId)}).then(()=>{v(P.projectId),h.$modal.msgSuccess("删除成功")}).catch(()=>{})}function B(e){let t="",i="文件";if(typeof e=="object"?e.htmlFilePath?(t=e.zipFilePath,i="原型HTML文件"):e.prototypeFilePath?(t=e.prototypeFilePath,i="原型RP文件"):e.requirementsFilePath?(t=e.requirementsFilePath,i="需求文档"):e.effectPictureFilePath&&(t=e.effectPictureFilePath,i="效果图文件"):t=e,!t){h.$modal.msgError("文件路径不存在");return}const f=`${"/".replace(/\/?$/,"")}${t}`,c=document.createElement("a");c.style.display="none",c.href=f;const S=`${(P.projectName||"项目").replace(/[\\/:*?"<>|]/g,"_")}_${i}`;c.setAttribute("download",S),document.body.appendChild(c),c.click(),document.body.removeChild(c)}function T(e,t){if(t.length===0)return!1;const C=t.map(f=>f.version).sort((f,c)=>c-f)[0];return e.version===C}return(e,t)=>{const i=V("el-button"),C=V("el-card"),f=V("el-input"),c=V("el-form-item"),m=V("el-form"),M=V("el-dialog"),S=V("el-upload");return y(),b("div",Ve,[l("div",Re,[Ue,a(i,{class:"right-button",onClick:le},{default:o(()=>[r("添加原型")]),_:1})]),l("div",De,[(y(!0),b(W,null,X(n(U),(s,j)=>(y(),H(C,{key:j,class:"prototype-card"},{header:o(()=>[l("div",Ee,[l("span",null,R(s.mockupName),1),l("div",Ne,[a(i,{onClick:u=>ae(s.projectMockupId)},{default:o(()=>[r("修改")]),_:2},1032,["onClick"]),a(i,{onClick:u=>ie(s.projectMockupId)},{default:o(()=>[r("删除")]),_:2},1032,["onClick"]),a(i,{onClick:u=>se(s.projectMockupId)},{default:o(()=>[r("上传新版本")]),_:2},1032,["onClick"])])])]),default:o(()=>[(y(!0),b(W,null,X(s.versions,(u,L)=>(y(),b("div",{key:L,class:"version-item"},[l("div",{class:"version-header",onClick:I=>J(u)},[l("span",{class:Fe(["version-number",{latest:T(u,s.versions)}])},[r(R(u.title)+" ",1),T(u,s.versions)?(y(),b("span",Se,"latest")):ee("",!0)],2),l("div",qe,[a(i,{icon:"Edit",circle:"",onClick:I=>ce(L,u)},null,8,["onClick"]),a(i,{icon:"Delete",circle:"",type:"danger",onClick:I=>pe(L,u)},null,8,["onClick"]),a(i,{onClick:I=>J(u)},{default:o(()=>[r(R(u.isExpanded?"收起":"展开"),1)]),_:2},1032,["onClick"])])],8,xe),u.isExpanded?(y(),b("div",ze,[l("div",Be,[l("div",He,[l("p",null,[Te,r(" "+R(u.createBy),1)]),l("p",null,[Le,r(" "+R(u.time),1)]),l("p",null,[Oe,r(" "+R(u.version),1)])])]),l("div",Ae,[Ze,l("pre",null,R(u.description),1)]),l("div",Je,[Ke,l("ul",null,[l("li",null,[Ge,a(i,{onClick:I=>re(u)},{default:o(()=>[r("立即访问")]),_:2},1032,["onClick"]),a(i,{onClick:I=>B(u)},{default:o(()=>[r("下载")]),_:2},1032,["onClick"])]),l("li",null,[Qe,u.prototypeFilePath?(y(),H(i,{key:0,onClick:I=>B(u.prototypeFilePath)},{default:o(()=>[r("下 载")]),_:2},1032,["onClick"])):(y(),b("span",We,"无"))]),l("li",null,[Xe,u.requirementsFilePath?(y(),H(i,{key:0,onClick:I=>B(u.requirementsFilePath)},{default:o(()=>[r("下 载")]),_:2},1032,["onClick"])):(y(),b("span",Ye,"无"))]),l("li",null,[et,u.effectPictureFilePath?(y(),H(i,{key:0,onClick:I=>B(u.effectPictureFilePath)},{default:o(()=>[r("下 载")]),_:2},1032,["onClick"])):(y(),b("span",tt,"无"))])])])])):ee("",!0)]))),128))]),_:2},1024))),128))]),a(M,{modelValue:n(D),"onUpdate:modelValue":t[2]||(t[2]=s=>O(D)?D.value=s:null),title:"新增原型",width:"30%"},{footer:o(()=>[l("span",ot,[a(i,{onClick:t[1]||(t[1]=s=>D.value=!1)},{default:o(()=>[r("取消")]),_:1}),a(i,{type:"primary",onClick:K},{default:o(()=>[r("确定")]),_:1})])]),default:o(()=>[a(m,{model:n(F),rules:e.rules,ref_key:"formRef",ref:N,"label-width":"80px","label-position":"top",onSubmit:Y(K,["prevent"])},{default:o(()=>[a(c,{label:"原型名称",prop:"name"},{default:o(()=>[a(f,{modelValue:n(F).mockupName,"onUpdate:modelValue":t[0]||(t[0]=s=>n(F).mockupName=s),placeholder:"请输入原型名称",style:{width:"100%"}},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue"]),a(M,{modelValue:n(E),"onUpdate:modelValue":t[5]||(t[5]=s=>O(E)?E.value=s:null),title:"编辑原型",width:"30%"},{footer:o(()=>[l("span",lt,[a(i,{onClick:t[4]||(t[4]=s=>E.value=!1)},{default:o(()=>[r("取消")]),_:1}),a(i,{type:"primary",onClick:G},{default:o(()=>[r("确定")]),_:1})])]),default:o(()=>[a(m,{model:n(F),rules:e.rules,ref_key:"formRef",ref:N,"label-width":"80px","label-position":"top",onSubmit:Y(G,["prevent"])},{default:o(()=>[a(c,{label:"原型名称",prop:"name"},{default:o(()=>[a(f,{modelValue:n(F).mockupName,"onUpdate:modelValue":t[3]||(t[3]=s=>n(F).mockupName=s),placeholder:"请输入原型名称",style:{width:"100%"}},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue"]),a(M,{title:n(d).title,modelValue:n(d).open,"onUpdate:modelValue":t[8]||(t[8]=s=>n(d).open=s),width:"900px","append-to-body":"","before-close":Q},{footer:o(()=>[l("div",ct,[a(i,{type:"primary",icon:"UploadFilled",onClick:ne},{default:o(()=>[r("提交上传")]),_:1}),a(i,{onClick:Q},{default:o(()=>[r("取消")]),_:1})])]),default:o(()=>[l("div",at,[a(m,{ref_key:"formRef",ref:N,model:n(d).data,rules:n(te),"label-width":"100px"},{default:o(()=>[a(c,{label:"标题",prop:"title"},{default:o(()=>[a(f,{modelValue:n(d).data.title,"onUpdate:modelValue":t[6]||(t[6]=s=>n(d).data.title=s),placeholder:"请输入标题",style:{width:"100%"}},null,8,["modelValue"])]),_:1}),a(c,{label:"发布说明",prop:"description"},{default:o(()=>[a(f,{modelValue:n(d).data.description,"onUpdate:modelValue":t[7]||(t[7]=s=>n(d).data.description=s),type:"textarea",rows:4,placeholder:"请输入发布说明",style:{width:"100%"}},null,8,["modelValue"])]),_:1}),a(c,{label:"HTML文件",prop:"htmlFile"},{default:o(()=>[a(S,{ref:"htmlUploadRef",limit:1,accept:".zip",headers:n(d).headers,action:n(d).htmlUrl,"on-success":(s,j)=>z(s,j,"html"),"auto-upload":!0,class:"custom-upload"},{tip:o(()=>[it]),default:o(()=>[a(i,{type:"primary"},{default:o(()=>[r("选择文件")]),_:1})]),_:1},8,["headers","action","on-success"])]),_:1}),a(c,{label:"原型文件RP"},{default:o(()=>[a(S,{ref:"rpUploadRef",limit:1,accept:".zip,.rp",headers:n(d).headers,action:n(d).fileUrl,"on-success":(s,j)=>z(s,j,"rp"),"auto-upload":!0},{tip:o(()=>[st]),default:o(()=>[a(i,null,{default:o(()=>[r("选择文件")]),_:1})]),_:1},8,["headers","action","on-success"])]),_:1}),a(c,{label:"需求文件"},{default:o(()=>[a(S,{ref:"requirementUploadRef",limit:1,accept:".doc,.docx,.pdf,.zip",headers:n(d).headers,action:n(d).fileUrl,"on-success":(s,j)=>z(s,j,"requirement"),"auto-upload":!0},{tip:o(()=>[nt]),default:o(()=>[a(i,null,{default:o(()=>[r("选择文件")]),_:1})]),_:1},8,["headers","action","on-success"])]),_:1}),a(c,{label:"效果图"},{default:o(()=>[a(S,{ref:"imageUploadRef",limit:1,accept:".zip",headers:n(d).headers,action:n(d).fileUrl,"on-success":(s,j)=>z(s,j,"image"),"auto-upload":!0},{tip:o(()=>[rt]),default:o(()=>[a(i,null,{default:o(()=>[r("选择文件")]),_:1})]),_:1},8,["headers","action","on-success"])]),_:1})]),_:1},8,["model","rules"])])]),_:1},8,["title","modelValue"]),a(M,{modelValue:n(x),"onUpdate:modelValue":t[12]||(t[12]=s=>O(x)?x.value=s:null),title:"编辑",width:"30%","before-close":ue},{footer:o(()=>[l("span",dt,[a(i,{onClick:t[11]||(t[11]=s=>x.value=!1)},{default:o(()=>[r("取消")]),_:1}),a(i,{type:"primary",onClick:de},{default:o(()=>[r("确定")]),_:1})])]),default:o(()=>[a(m,{model:n(g),rules:oe,ref_key:"editDescriptionFormRef",ref:Z,"label-position":"top","label-width":"120px"},{default:o(()=>[a(c,{label:"标题",prop:"title"},{default:o(()=>[a(f,{modelValue:n(g).title,"onUpdate:modelValue":t[9]||(t[9]=s=>n(g).title=s),placeholder:"请输入标题",style:{width:"100%"}},null,8,["modelValue"])]),_:1}),a(c,{label:"发布说明",prop:"description"},{default:o(()=>[a(f,{modelValue:n(g).uploadDescription,"onUpdate:modelValue":t[10]||(t[10]=s=>n(g).uploadDescription=s),type:"textarea",rows:4,placeholder:"请输入发布说明",style:{width:"100%"}},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])])}}}),ft=me(pt,[["__scopeId","data-v-4b445b16"]]);export{ft as default};
