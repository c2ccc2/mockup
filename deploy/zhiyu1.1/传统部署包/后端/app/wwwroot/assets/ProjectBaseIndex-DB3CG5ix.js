import{V as me,B as Ge,d as Ke,r as u,D as de,X as He,H as Oe,e as s,L as ue,c as pe,o as g,M as m,f as e,N as $,h as l,l as se,k as n,n as r,i as h,F as Xe,C as Je,m as w}from"./index-CFxQbL7N.js";import{M as We,a as Ye,d as Ze,u as el,b as ll}from"./projectbase-BMzjPQMm.js";import{d as al,G as ce,a as tl}from"./projectuser-BROGw_zh.js";function ol(R){return me({url:"/projectManager/filehistory/GetCustomPagedListAsync",method:"post",data:R})}function nl(R){return me({url:"/projectManager/filehistory/GetLastRecordByProjectId/"+R,method:"get"})}const rl={class:"app-container"},il={class:"dialog-footer"},dl={class:"app-container"},ul={class:"app-container"},pl={class:"app-container"},sl=w("div",{class:"el-upload__text"},[r("将文件拖到此处，或"),w("em",null,"点击上传")],-1),cl=w("div",{class:"el-upload__tip text-center"},[w("div",{class:"el-upload__tip"}),w("span",null,"仅允许导入zip格式文件。")],-1),ml={class:"dialog-footer"},fl=Ge({name:"ProjectBase"}),jl=Object.assign(fl,{setup(R){const{proxy:d}=Ke(),T=u(!1),Q=u(!1),E=u(!1),{project_states:fe}=d.useDict("project_states"),J=u([]),C=u(!1),v=u(!0),A=u(!0),G=u([]),W=u(!0),Y=u(!0),U=u(0),Z=u(0),ee=u(0),K=u(""),le=u([]),ae=u([]),te=u([]),c=de({open:!1,title:"上传原型文件,zip格式",isUploading:!1,data:{UploadDescription:"",ProjectFileId:""},headers:{Authorization:"Bearer "+He()},url:"/prod-api/projectManager/projectfile/AddFileToProjectFile"}),ge=de({form:{projectId:0,projectName:"",projectDescription:"",projectState:10,createBy:"",createTime:"",updateBy:"",updateTime:""},queryParams:{pageModel:{PageIndex:1,PageSize:10},projectName:null},userqueryParams:{pageModel:{PageIndex:1,PageSize:10},projectId:0,selectType:"join",userName:""},unjoinuserqueryParams:{pageModel:{PageIndex:1,PageSize:10},projectId:0,selectType:"unjoin",userName:""},filequeryParams:{pageModel:{PageIndex:1,PageSize:10},projectId:0,UploadDescription:""},rules:{projectName:[{required:!0,message:"项目名称不能为空",trigger:"blur"}]}}),{queryParams:b,userqueryParams:_,unjoinuserqueryParams:j,filequeryParams:P,form:y,rules:ve}=Oe(ge);function x(){v.value=!0,We(b.value).then(o=>{J.value=o.rows,U.value=o.total,v.value=!1})}function oe(){v.value=!0,ce(_.value).then(o=>{le.value=o.rows,Z.value=o.total,v.value=!1})}function ne(){v.value=!0,ce(j.value).then(o=>{ae.value=o.rows,ee.value=o.total,v.value=!1})}function M(){v.value=!0,ol(P.value).then(o=>{te.value=o.rows,U.value=o.total,v.value=!1})}const _e=()=>{c.isUploading=!0},je=(o,a)=>{c.open=!1,c.isUploading=!1,d.$refs.uploadRef.handleRemove(a),d.$alert("<div style='overflow: auto;overflow-x: hidden;max-height: 70vh;padding: 10px 20px 0;'>"+o.msg+"</div>","上传结果",{dangerouslyUseHTMLString:!0}),M()};function ye(){E.value=!0,B()}function he(){C.value=!1,H()}function H(){y.value={projectId:0,projectName:"",projectDescription:"",projectState:10,createBy:"",createTime:"",updateBy:"",updateTime:""},d.resetForm("projectBaseRef")}async function O(){b.value.pageModel.PageIndex=1,x()}async function S(){oe()}async function B(){j.value.pageModel.PageIndex=1,j.value.selectType="unjoin",ne()}function we(){d.resetForm("queryUserRef"),S()}function be(){d.resetForm("queryunjoinUserRef"),B()}function Pe(){d.resetForm("queryFileRef"),M()}function ke(){d.resetForm("queryRef"),O()}function Ue(o){G.value=o.map(a=>a.projectId),W.value=o.length!==1,Y.value=!o.length}function Ie(){H(),C.value=!0,K.value="添加项目"}function re(o){H();const a=o.projectId||G.value;Ye(a).then(f=>{y.value=f.data,C.value=!0,K.value="修改项目"})}function Ce(){d.$refs.projectBaseRef.validate(o=>{o&&(y.value.projectId!=null&&y.value.projectId>0?el(y.value).then(()=>{d.$modal.msgSuccess("修改成功"),C.value=!1,x()}):ll(y.value).then(()=>{d.$modal.msgSuccess("新增成功"),C.value=!1,x()}))})}function ie(o){const a=o.projectId||G.value;d.$modal.confirm('是否确认删除编号为"'+a+'"的数据项？').then(function(){return Ze(a)}).then(()=>{x(),d.$modal.msgSuccess("删除成功")}).catch(()=>{})}function xe(){d.download("projectManager/projectBase/export",{...b.value},`projectBase_${new Date().getTime()}.xlsx`)}function Ve(o){_.value.projectId=o.projectId,j.value.projectId=o.projectId,T.value=!0,S()}function Me(o){P.value.projectId=o.projectId,c.data.ProjectFileId=6,Q.value=!0,X()}function X(){P.value.pageModel.PageIndex=1,M()}function Se(o){d.$modal.confirm("是否确认用户加入到项目？").then(function(){const a={projectId:_.value.projectId,userId:o.userId};tl(a).then(()=>{d.$modal.msgSuccess("添加成功"),S(),B()}).catch(f=>{d.$modal.msgError("添加失败："+f.message)})}).catch(()=>{})}function Be(o){d.$modal.confirm("是否确认把用户从项目移除？").then(function(){const a={projectId:_.value.projectId,userIds:[o.userId]};al(a).then(()=>{d.$modal.msgSuccess("移除成功"),S(),B()}).catch(f=>{d.$modal.msgError("移除失败："+f.message)})}).catch(()=>{})}function Ne(){d.$refs.uploadRef.submit(),M()}function Fe(){c.open=!0}function $e(o){window.open("/prod-api/upload/projectunzip/"+o.projectFileId+"/index.html","_blank")}function Re(o){nl(o.projectId).then(a=>{var f=a.data;window.open("/prod-api/"+f.filePath,"_blank")})}function De(o){window.open("/prod-api/"+o.filePath,"_blank")}return x(),(o,a)=>{const f=s("el-input"),k=s("el-form-item"),i=s("el-button"),N=s("el-form"),D=s("el-col"),qe=s("right-toolbar"),ze=s("el-row"),p=s("el-table-column"),q=s("el-table"),z=s("pagination"),Le=s("el-option"),Te=s("el-select"),F=s("el-dialog"),Qe=s("upload-filled"),Ee=s("el-icon"),Ae=s("el-upload"),V=ue("hasPermi"),L=ue("loading");return g(),pe("div",rl,[m(e(N,{model:n(b),ref:"queryRef",inline:!0,"label-width":"68px"},{default:l(()=>[e(k,{label:"项目名称",prop:"projectName"},{default:l(()=>[e(f,{modelValue:n(b).projectName,"onUpdate:modelValue":a[0]||(a[0]=t=>n(b).projectName=t),placeholder:"请输入项目名称",clearable:"",onKeyup:se(O,["enter"])},null,8,["modelValue"])]),_:1}),e(k,null,{default:l(()=>[e(i,{type:"primary",icon:"Search",onClick:O},{default:l(()=>[r("搜索")]),_:1}),e(i,{icon:"Refresh",onClick:ke},{default:l(()=>[r("重置")]),_:1})]),_:1})]),_:1},8,["model"]),[[$,A.value]]),e(ze,{gutter:10,class:"mb8"},{default:l(()=>[e(D,{span:1.5},{default:l(()=>[m((g(),h(i,{type:"primary",plain:"",icon:"Plus",onClick:Ie},{default:l(()=>[r("新增")]),_:1})),[[V,["projectManager:projectBase:add"]]])]),_:1}),e(D,{span:1.5},{default:l(()=>[m((g(),h(i,{type:"success",plain:"",icon:"Edit",disabled:W.value,onClick:re},{default:l(()=>[r("修改")]),_:1},8,["disabled"])),[[V,["projectManager:projectBase:edit"]]])]),_:1}),e(D,{span:1.5},{default:l(()=>[m((g(),h(i,{type:"danger",plain:"",icon:"Delete",disabled:Y.value,onClick:ie},{default:l(()=>[r("删除")]),_:1},8,["disabled"])),[[V,["projectManager:projectBase:remove"]]])]),_:1}),e(D,{span:1.5},{default:l(()=>[m((g(),h(i,{type:"warning",plain:"",icon:"Download",onClick:xe},{default:l(()=>[r("导出")]),_:1})),[[V,["projectManager:projectBase:export"]]])]),_:1}),e(qe,{showSearch:A.value,"onUpdate:showSearch":a[1]||(a[1]=t=>A.value=t),onQueryTable:x},null,8,["showSearch"])]),_:1}),m((g(),h(q,{data:J.value,onSelectionChange:Ue},{default:l(()=>[e(p,{type:"selection",width:"55",align:"center"}),e(p,{label:"项目ID",align:"center",prop:"projectId",width:"55"}),e(p,{label:"项目名称",align:"center",prop:"projectName"}),e(p,{label:"操作",align:"center","class-name":"small-padding fixed-width"},{default:l(t=>[e(i,{link:"",type:"primary",icon:"User",onClick:I=>Ve(t.row)},{default:l(()=>[r("项目用户")]),_:2},1032,["onClick"]),e(i,{link:"",type:"primary",icon:"User",onClick:I=>Me(t.row)},{default:l(()=>[r("原型上传")]),_:2},1032,["onClick"]),e(i,{link:"",type:"primary",icon:"User",onClick:I=>$e(t.row)},{default:l(()=>[r("原型预览")]),_:2},1032,["onClick"]),e(i,{link:"",type:"primary",icon:"User",onClick:I=>Re(t.row)},{default:l(()=>[r("下载")]),_:2},1032,["onClick"]),m((g(),h(i,{link:"",type:"primary",icon:"Edit",onClick:I=>re(t.row)},{default:l(()=>[r("修改")]),_:2},1032,["onClick"])),[[V,["projectManager:projectBase:edit"]]]),m((g(),h(i,{link:"",type:"primary",icon:"Delete",onClick:I=>ie(t.row)},{default:l(()=>[r("删除")]),_:2},1032,["onClick"])),[[V,["projectManager:projectBase:remove"]]])]),_:1})]),_:1},8,["data"])),[[L,v.value]]),m(e(z,{total:U.value,page:n(b).pageModel.PageIndex,"onUpdate:page":a[2]||(a[2]=t=>n(b).pageModel.PageIndex=t),limit:n(b).pageModel.PageSize,"onUpdate:limit":a[3]||(a[3]=t=>n(b).pageModel.PageSize=t),onPagination:x},null,8,["total","page","limit"]),[[$,U.value>0]]),e(F,{title:K.value,modelValue:C.value,"onUpdate:modelValue":a[6]||(a[6]=t=>C.value=t),width:"500px","append-to-body":""},{footer:l(()=>[w("div",il,[e(i,{type:"primary",onClick:Ce},{default:l(()=>[r("确 定")]),_:1}),e(i,{onClick:he},{default:l(()=>[r("取 消")]),_:1})])]),default:l(()=>[e(N,{ref:"projectBaseRef",model:n(y),rules:n(ve),"label-width":"80px"},{default:l(()=>[e(k,{label:"项目名称",prop:"projectName"},{default:l(()=>[e(f,{modelValue:n(y).projectName,"onUpdate:modelValue":a[4]||(a[4]=t=>n(y).projectName=t),placeholder:"请输入项目名称"},null,8,["modelValue"])]),_:1}),e(k,{label:"项目状态",prop:"projectState"},{default:l(()=>[e(Te,{modelValue:n(y).projectState,"onUpdate:modelValue":a[5]||(a[5]=t=>n(y).projectState=t),placeholder:"请选择项目状态"},{default:l(()=>[(g(!0),pe(Xe,null,Je(n(fe),t=>(g(),h(Le,{key:t.value,label:t.label,value:parseInt(t.value)},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["title","modelValue"]),e(F,{modelValue:T.value,"onUpdate:modelValue":a[10]||(a[10]=t=>T.value=t),title:"已加入项目用户",width:"800px","append-to-body":""},{default:l(()=>[w("div",dl,[e(N,{model:n(_),ref:"queryUserRef",inline:!0},{default:l(()=>[e(k,{label:"用户名称",prop:"userName"},{default:l(()=>[e(f,{modelValue:n(_).userName,"onUpdate:modelValue":a[7]||(a[7]=t=>n(_).userName=t),placeholder:"请输入用户名称",clearable:"",style:{width:"240px"}},null,8,["modelValue"])]),_:1}),e(k,null,{default:l(()=>[e(i,{type:"primary",icon:"Search",onClick:S},{default:l(()=>[r("搜索")]),_:1}),e(i,{icon:"Refresh",onClick:we},{default:l(()=>[r("重置")]),_:1}),e(i,{type:"primary",icon:"Plus",onClick:ye},{default:l(()=>[r("添加用户")]),_:1})]),_:1})]),_:1},8,["model"]),m((g(),h(q,{data:le.value},{default:l(()=>[e(p,{label:"用户名称",prop:"userName","show-overflow-tooltip":!0}),e(p,{label:"用户昵称",prop:"nickName","show-overflow-tooltip":!0}),e(p,{label:"手机",prop:"phonenumber","show-overflow-tooltip":!0}),e(p,{label:"操作",align:"center","class-name":"small-padding fixed-width"},{default:l(t=>[e(i,{link:"",type:"primary",icon:"Remove",onClick:I=>Be(t.row)},{default:l(()=>[r("移除")]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])),[[L,v.value]]),m(e(z,{total:U.value,page:n(_).pageModel.PageIndex,"onUpdate:page":a[8]||(a[8]=t=>n(_).pageModel.PageIndex=t),limit:n(_).pageModel.pageSize,"onUpdate:limit":a[9]||(a[9]=t=>n(_).pageModel.pageSize=t),onPagination:oe},null,8,["total","page","limit"]),[[$,Z.value>0]])])]),_:1},8,["modelValue"]),e(F,{modelValue:E.value,"onUpdate:modelValue":a[14]||(a[14]=t=>E.value=t),title:"待加入项目用户",width:"800px","append-to-body":""},{default:l(()=>[w("div",ul,[e(N,{model:n(j),ref:"queryunjoinUserRef",inline:!0},{default:l(()=>[e(k,{label:"用户名称",prop:"userName"},{default:l(()=>[e(f,{modelValue:n(j).userName,"onUpdate:modelValue":a[11]||(a[11]=t=>n(j).userName=t),placeholder:"请输入用户名称",clearable:"",style:{width:"240px"}},null,8,["modelValue"])]),_:1}),e(k,null,{default:l(()=>[e(i,{type:"primary",icon:"Search",onClick:B},{default:l(()=>[r("搜索")]),_:1}),e(i,{icon:"Refresh",onClick:be},{default:l(()=>[r("重置")]),_:1})]),_:1})]),_:1},8,["model"]),m((g(),h(q,{data:ae.value},{default:l(()=>[e(p,{label:"用户名称",prop:"userName","show-overflow-tooltip":!0}),e(p,{label:"用户昵称",prop:"nickName","show-overflow-tooltip":!0}),e(p,{label:"手机",prop:"phonenumber","show-overflow-tooltip":!0}),e(p,{label:"操作",align:"center","class-name":"small-padding fixed-width"},{default:l(t=>[e(i,{link:"",type:"primary",icon:"CircleClose",onClick:I=>Se(t.row)},{default:l(()=>[r("加入")]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])),[[L,v.value]]),m(e(z,{total:U.value,page:n(j).pageModel.PageIndex,"onUpdate:page":a[12]||(a[12]=t=>n(j).pageModel.PageIndex=t),limit:n(j).pageModel.pageSize,"onUpdate:limit":a[13]||(a[13]=t=>n(j).pageModel.pageSize=t),onPagination:ne},null,8,["total","page","limit"]),[[$,ee.value>0]])])]),_:1},8,["modelValue"]),e(F,{modelValue:Q.value,"onUpdate:modelValue":a[18]||(a[18]=t=>Q.value=t),title:"项目原型管理",width:"800px","append-to-body":""},{default:l(()=>[w("div",pl,[e(N,{model:n(P),ref:"queryFileRef",inline:!0},{default:l(()=>[e(k,{label:"描述",prop:"UploadDescription"},{default:l(()=>[e(f,{modelValue:n(P).UploadDescription,"onUpdate:modelValue":a[15]||(a[15]=t=>n(P).UploadDescription=t),placeholder:"请输入关键字",clearable:"",style:{width:"240px"},onKeyup:se(X,["enter"])},null,8,["modelValue"])]),_:1}),e(k,null,{default:l(()=>[e(i,{type:"primary",icon:"Search",onClick:X},{default:l(()=>[r("搜索")]),_:1}),e(i,{icon:"Refresh",onClick:Pe},{default:l(()=>[r("重置")]),_:1}),e(i,{icon:"primary",onClick:Fe},{default:l(()=>[r("添加")]),_:1})]),_:1})]),_:1},8,["model"]),m((g(),h(q,{data:te.value},{default:l(()=>[e(p,{type:"selection",width:"55",align:"center"}),r(" --> "),e(p,{label:"创建日期",prop:"createTime","show-overflow-tooltip":!0}),e(p,{label:"描述",prop:"uploadDescription","show-overflow-tooltip":!0}),e(p,{label:"操作",align:"center","class-name":"small-padding fixed-width"},{default:l(t=>[e(i,{link:"",type:"primary",icon:"CircleClose",onClick:I=>De(t.row)},{default:l(()=>[r("下载")]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])),[[L,v.value]]),m(e(z,{total:U.value,page:n(P).pageModel.PageIndex,"onUpdate:page":a[16]||(a[16]=t=>n(P).pageModel.PageIndex=t),limit:n(P).pageModel.PageSize,"onUpdate:limit":a[17]||(a[17]=t=>n(P).pageModel.PageSize=t),onPagination:M},null,8,["total","page","limit"]),[[$,U.value>0]])])]),_:1},8,["modelValue"]),e(F,{title:c.title,modelValue:c.open,"onUpdate:modelValue":a[21]||(a[21]=t=>c.open=t),width:"400px","append-to-body":""},{footer:l(()=>[w("div",ml,[e(i,{type:"primary",onClick:Ne},{default:l(()=>[r("确 定")]),_:1}),e(i,{onClick:a[20]||(a[20]=t=>c.open=!1)},{default:l(()=>[r("取 消")]),_:1})])]),default:l(()=>[e(Ae,{ref:"uploadRef",limit:1,accept:"zip,rar",data:c.data,headers:c.headers,action:c.url,disabled:c.isUploading,"on-progress":_e,"on-success":je,"auto-upload":!1,drag:""},{tip:l(()=>[cl]),default:l(()=>[e(Ee,{class:"el-icon--upload"},{default:l(()=>[e(Qe)]),_:1}),sl]),_:1},8,["data","headers","action","disabled"]),w("div",null,[e(f,{modelValue:c.data.UploadDescription,"onUpdate:modelValue":a[19]||(a[19]=t=>c.data.UploadDescription=t),type:"textarea",placeholder:"请输入描述"},null,8,["modelValue"])])]),_:1},8,["title","modelValue"])])}}});export{jl as default};
